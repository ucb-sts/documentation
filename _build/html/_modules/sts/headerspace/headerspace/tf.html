<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sts.headerspace.headerspace.tf &mdash; STS 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="STS 0.1 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">STS 0.1 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for sts.headerspace.headerspace.tf</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Created on Jan 24, 2011</span>

<span class="sd">@author: peyman kazemian</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">sts.headerspace.headerspace.hs</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
<span class="kn">from</span> <span class="nn">sts.headerspace.headerspace.wildcard_dictionary</span> <span class="kn">import</span> <span class="n">wildcard_dictionary</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;headerspace&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ports_to_hex"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.ports_to_hex">[docs]</a><span class="k">def</span> <span class="nf">ports_to_hex</span><span class="p">(</span><span class="n">ports</span><span class="p">):</span>
  <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="n">port_to_hex</span><span class="p">,</span> <span class="n">ports</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="port_to_hex"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.port_to_hex">[docs]</a><span class="k">def</span> <span class="nf">port_to_hex</span><span class="p">(</span><span class="n">port</span><span class="p">):</span>
  <span class="k">return</span> <span class="nb">hex</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TF"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF">[docs]</a><span class="k">class</span> <span class="nc">TF</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  models a box transfer function, a network transfer function or a topology transfer function</span>
<span class="sd">  &#39;&#39;&#39;</span>

<div class="viewcode-block" id="TF.__init__"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hsa_format</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Constructor</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># For backwards compabibility</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">hsa_format</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">hsa_format</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">hsa_format</span><span class="p">[</span><span class="s">&quot;length&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">hsa_format</span>
      
    <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">custom_rules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lazy_eval_nibbles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inport_to_rule</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">outport_to_rule</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id_to_rule</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prefix_id</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lazy_eval_active</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send_on_receiving_port</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c"># TRIAL - won&#39;t be saved upon tf.save()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hash_table_active</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hash_nibble_indices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inport_to_hash_table</span> <span class="o">=</span> <span class="p">{}</span>
</div>
<div class="viewcode-block" id="TF.set_prefix_id"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.set_prefix_id">[docs]</a>  <span class="k">def</span> <span class="nf">set_prefix_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">str_prefix</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prefix_id</span> <span class="o">=</span> <span class="n">str_prefix</span>
</div>
<div class="viewcode-block" id="TF.set_send_on_receiving_port"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.set_send_on_receiving_port">[docs]</a>  <span class="k">def</span> <span class="nf">set_send_on_receiving_port</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">send_on_receiving_port</span> <span class="o">=</span> <span class="n">val</span>
</div>
<div class="viewcode-block" id="TF.generate_next_id"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.generate_next_id">[docs]</a>  <span class="k">def</span> <span class="nf">generate_next_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">_</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix_id</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">next_id</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TF.set_lazy_evaluate"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.set_lazy_evaluate">[docs]</a>  <span class="k">def</span> <span class="nf">set_lazy_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">list_of_nibbles</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lazy_eval_nibbles</span> <span class="o">=</span> <span class="n">list_of_nibbles</span>
</div>
<div class="viewcode-block" id="TF.activate_lazy_eval"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.activate_lazy_eval">[docs]</a>  <span class="k">def</span> <span class="nf">activate_lazy_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lazy_eval_active</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="TF.deactivate_lazy_eval"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.deactivate_lazy_eval">[docs]</a>  <span class="k">def</span> <span class="nf">deactivate_lazy_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">lazy_eval_active</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="TF.activate_hash_table"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.activate_hash_table">[docs]</a>  <span class="k">def</span> <span class="nf">activate_hash_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nibble_indices</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hash_table_active</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hash_nibble_indices</span> <span class="o">=</span> <span class="n">nibble_indices</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inport_to_rule</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">inport_to_hash_table</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">wildcard_dictionary</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inport_to_rule</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_nibble_indices</span><span class="p">:</span>
          <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inport_to_hash_table</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">add_entry</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">rule</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TF.deactivate_hash_table"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.deactivate_hash_table">[docs]</a>  <span class="k">def</span> <span class="nf">deactivate_hash_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hash_table_active</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="TF.print_influences"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.print_influences">[docs]</a>  <span class="k">def</span> <span class="nf">print_influences</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    For each rule, shows the list of higher priority rules that has an intersection with</span>
<span class="sd">    the rule, and also the lower priority rules that has an intersection with the rule,</span>
<span class="sd">    in two separate lists.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> Rule Match: </span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;action&quot;</span><span class="p">],</span><span class="n">byte_array_to_pretty_hs_string</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">]),</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">])</span>
      <span class="k">print</span> <span class="s">&quot;Affected by:&quot;</span>
      <span class="k">for</span> <span class="n">aff</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;affected_by&quot;</span><span class="p">]:</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: On Ports </span><span class="si">%s</span><span class="s">, Intersect= </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">byte_array_to_pretty_hs_string</span><span class="p">(</span><span class="n">aff</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&quot;match&quot;</span><span class="p">]),</span><span class="n">aff</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                                                <span class="n">byte_array_to_pretty_hs_string</span><span class="p">(</span><span class="n">aff</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
      <span class="k">print</span> <span class="s">&quot;Influence on:&quot;</span>
      <span class="k">for</span> <span class="n">aff</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;influence_on&quot;</span><span class="p">]:</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">byte_array_to_pretty_hs_string</span><span class="p">(</span><span class="n">aff</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">]))</span>
      <span class="k">print</span> <span class="s">&quot;-------------------&quot;</span>
      </div>
<div class="viewcode-block" id="TF.hs_string"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.hs_string">[docs]</a>  <span class="k">def</span> <span class="nf">hs_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">byte_array</span><span class="p">):</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">headerspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
    <span class="n">match</span><span class="o">.</span><span class="n">add_hs</span><span class="p">(</span><span class="n">byte_array</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="TF.to_string"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.to_string">[docs]</a>  <span class="k">def</span> <span class="nf">to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
      <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hs_string</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;match&#39;</span><span class="p">])</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rw&#39;</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hs_string</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;mask&#39;</span><span class="p">])</span>
        <span class="n">rewrite</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hs_string</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;rewrite&#39;</span><span class="p">])</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">&quot;in_ports: </span><span class="si">%s</span><span class="s">, match: </span><span class="si">%s</span><span class="s"> =&gt; ((h &amp; </span><span class="si">%s</span><span class="s">) | </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;in_ports&#39;</span><span class="p">]),</span> \
                    <span class="n">match</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">rewrite</span><span class="p">,</span> <span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;out_ports&#39;</span><span class="p">]))</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;fwd&#39;</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">&quot;in_ports: </span><span class="si">%s</span><span class="s">, match: </span><span class="si">%s</span><span class="s"> =&gt; (h , </span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;in_ports&#39;</span><span class="p">]),</span> \
                    <span class="n">match</span><span class="p">,</span> <span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;out_ports&#39;</span><span class="p">]))</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;link&#39;</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">&quot;in_ports: </span><span class="si">%s</span><span class="s"> =&gt; out_ports: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;in_ports&#39;</span><span class="p">]),</span> \
                    <span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;out_ports&#39;</span><span class="p">]))</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;custom&#39;</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">&quot;match: </span><span class="si">%s</span><span class="s"> , transform: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;match&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> \
                    <span class="n">rule</span><span class="p">[</span><span class="s">&#39;transform&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">strings</span>
</div>
<div class="viewcode-block" id="TF.inv_to_string"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.inv_to_string">[docs]</a>  <span class="k">def</span> <span class="nf">inv_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rw&#39;</span><span class="p">):</span>
        <span class="n">inv_match</span> <span class="o">=</span> <span class="n">byte_array_to_hs_string</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;inverse_match&#39;</span><span class="p">])</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">byte_array_to_hs_string</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;mask&#39;</span><span class="p">])</span>
        <span class="n">inv_rewrite</span> <span class="o">=</span> <span class="n">byte_array_to_hs_string</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;inverse_rewrite&#39;</span><span class="p">])</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">&quot;out_ports: </span><span class="si">%s</span><span class="s"> match: </span><span class="si">%s</span><span class="s"> =&gt; ((h &amp; </span><span class="si">%s</span><span class="s">) | </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;out_ports&#39;</span><span class="p">]),</span> \
                    <span class="n">inv_match</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">inv_rewrite</span><span class="p">,</span> <span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;in_ports&#39;</span><span class="p">]))</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;fwd&#39;</span><span class="p">):</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">byte_array_to_hs_string</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;match&#39;</span><span class="p">])</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">&quot;out_ports: </span><span class="si">%s</span><span class="s"> match: </span><span class="si">%s</span><span class="s"> =&gt; (h , </span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;out_ports&#39;</span><span class="p">]),</span> \
                    <span class="n">match</span><span class="p">,</span> <span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;in_ports&#39;</span><span class="p">]))</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;link&#39;</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">&quot;out_ports: </span><span class="si">%s</span><span class="s"> =&gt; in_ports: </span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">((</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;out_ports&#39;</span><span class="p">]),</span> \
                    <span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;in_ports&#39;</span><span class="p">]))</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">strings</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TF.create_multirewrite_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.create_multirewrite_rule">[docs]</a>  <span class="k">def</span> <span class="nf">create_multirewrite_rule</span><span class="p">(</span><span class="n">in_ports</span><span class="p">,</span> <span class="n">match</span><span class="p">,</span> <span class="n">rules</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    creates a rule that if matches on in_ports, match, does all the actions</span>
<span class="sd">    in rules. the in_ports,matches in rules will be the same as in_ports, match</span>
<span class="sd">    in the multi-rewrite rule.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">in_ports</span>
    <span class="k">if</span>  <span class="n">match</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hs_string_to_byte_array</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">match</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">bytearray</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;rules&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rules</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;influence_on&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;affected_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">rule</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TF.create_custom_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.create_custom_rule">[docs]</a>  <span class="k">def</span> <span class="nf">create_custom_rule</span><span class="p">(</span><span class="n">match</span><span class="p">,</span><span class="n">transform</span><span class="p">,</span><span class="n">inv_match</span><span class="p">,</span><span class="n">inv_transform</span><span class="p">,</span><span class="n">file_name</span><span class="p">,</span><span class="n">lines</span><span class="p">):</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;inv_match&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv_match</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;transform&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transform</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;inv_transform&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv_transform</span>
    <span class="k">if</span> <span class="n">file_name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;line&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;line&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">rule</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TF.create_standard_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.create_standard_rule">[docs]</a>  <span class="k">def</span> <span class="nf">create_standard_rule</span><span class="p">(</span><span class="n">in_ports</span><span class="p">,</span> <span class="n">match</span><span class="p">,</span> <span class="n">out_ports</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">rewrite</span><span class="p">,</span><span class="n">file_name</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">lines</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create a rule using input arguments. Use None if an input is not applicable.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">rule</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">in_ports</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;out_ports&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out_ports</span>
    <span class="k">if</span>  <span class="n">match</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hs_string_to_byte_array</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">match</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">bytearray</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hs_string_to_byte_array</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mask</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">bytearray</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span>  <span class="n">rewrite</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;rewrite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hs_string_to_byte_array</span><span class="p">(</span><span class="n">rewrite</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">rewrite</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="nb">bytearray</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;rewrite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">rewrite</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;rewrite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;influence_on&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;affected_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">file_name</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_name</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;line&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;line&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    <span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">rule</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TF.standard_rule_to_string"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.standard_rule_to_string">[docs]</a>  <span class="k">def</span> <span class="nf">standard_rule_to_string</span><span class="p">(</span><span class="n">std_rule</span><span class="p">):</span>
    <span class="n">string</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;ID = </span><span class="si">%s</span><span class="s">, &quot;</span><span class="o">%</span><span class="n">std_rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span>
    <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;in_ports = </span><span class="si">%s</span><span class="s">, &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">std_rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">])</span>
    <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;match = </span><span class="si">%s</span><span class="s">, &quot;</span><span class="o">%</span><span class="n">byte_array_to_hs_string</span><span class="p">(</span><span class="n">std_rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">])</span>
    <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;mask = </span><span class="si">%s</span><span class="s">, &quot;</span><span class="o">%</span><span class="n">byte_array_to_hs_string</span><span class="p">(</span><span class="n">std_rule</span><span class="p">[</span><span class="s">&quot;mask&quot;</span><span class="p">])</span>
    <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;rewrite = </span><span class="si">%s</span><span class="s">, &quot;</span><span class="o">%</span><span class="n">byte_array_to_hs_string</span><span class="p">(</span><span class="n">std_rule</span><span class="p">[</span><span class="s">&quot;rewrite&quot;</span><span class="p">])</span>
    <span class="n">string</span> <span class="o">+=</span> <span class="s">&quot;out_ports = </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">std_rule</span><span class="p">[</span><span class="s">&quot;out_ports&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">string</span>
</div>
<div class="viewcode-block" id="TF.find_influences"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.find_influences">[docs]</a>  <span class="k">def</span> <span class="nf">find_influences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">priority</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    After inserting the new_rule, into self.rules, call this method to update the</span>
<span class="sd">    rule dependencies.</span>
<span class="sd">    @priority: priority or position of the new rule in the table</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">new_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">priority</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">priority</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;rw&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;fwd&quot;</span><span class="p">:</span>
        <span class="n">common_ports</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;in_ports&quot;</span><span class="p">]]</span>
        <span class="n">intersect</span> <span class="o">=</span> <span class="n">byte_array_intersect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;match&quot;</span><span class="p">],</span><span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intersect</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">common_ports</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;affected_by&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">intersect</span><span class="p">,</span><span class="n">common_ports</span><span class="p">))</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;influence_on&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">priority</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">priority</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">)):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;rw&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;fwd&quot;</span><span class="p">:</span>
        <span class="n">common_ports</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;in_ports&quot;</span><span class="p">]]</span>
        <span class="n">intersect</span> <span class="o">=</span> <span class="n">byte_array_intersect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;match&quot;</span><span class="p">],</span><span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">intersect</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">common_ports</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;influence_on&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&quot;affected_by&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">priority</span><span class="p">],</span><span class="n">intersect</span><span class="p">,</span><span class="n">common_ports</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TF.set_fast_lookup_pointers"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.set_fast_lookup_pointers">[docs]</a>  <span class="k">def</span> <span class="nf">set_fast_lookup_pointers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">priority</span><span class="p">):</span>
    <span class="n">new_rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">priority</span><span class="p">]</span>
    <span class="n">in_ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">priority</span><span class="p">][</span><span class="s">&quot;in_ports&quot;</span><span class="p">]</span>
    <span class="n">out_ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">priority</span><span class="p">][</span><span class="s">&quot;out_ports&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">in_ports</span><span class="p">:</span>
      <span class="n">port</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">p</span>
      <span class="k">if</span> <span class="n">port</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inport_to_rule</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inport_to_rule</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">inport_to_rule</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_rule</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">out_ports</span><span class="p">:</span>
      <span class="n">port</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">p</span>
      <span class="k">if</span> <span class="n">port</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outport_to_rule</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outport_to_rule</span><span class="p">[</span><span class="n">port</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">outport_to_rule</span><span class="p">[</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_rule</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id_to_rule</span><span class="p">[</span><span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">new_rule</span>
</div>
<div class="viewcode-block" id="TF.add_rewrite_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.add_rewrite_rule">[docs]</a>  <span class="k">def</span> <span class="nf">add_rewrite_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    rule is a dictionary with following keys:</span>
<span class="sd">    * &#39;match&#39;: a bytearray of length self.length describing the header formats that</span>
<span class="sd">    match this rule.</span>
<span class="sd">    * &#39;in_ports&#39;: the list of input port numbers to match on</span>
<span class="sd">    * &#39;mask&#39;: a bytearray of length self.length that masks all the bits that won&#39;t</span>
<span class="sd">    be rewritten</span>
<span class="sd">    * &#39;rewrite&#39;: a bytearray of length self.length that rewrites the desired bits.</span>
<span class="sd">    * &#39;out_ports&#39;: the list of output port numbers.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">extended_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&#39;match&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;match&#39;</span><span class="p">])</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;mask&#39;</span><span class="p">])</span>
    <span class="c"># Mask rewrite</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&#39;rewrite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">byte_array_and</span><span class="p">(</span><span class="n">byte_array_not</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;mask&#39;</span><span class="p">]),</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;rewrite&#39;</span><span class="p">])</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;rw&quot;</span>

    <span class="n">masked</span> <span class="o">=</span> <span class="n">byte_array_and</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;match&#39;</span><span class="p">],</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;mask&#39;</span><span class="p">])</span>
    <span class="n">rng</span> <span class="o">=</span> <span class="n">byte_array_or</span><span class="p">(</span><span class="n">masked</span><span class="p">,</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;rewrite&#39;</span><span class="p">])</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&#39;inverse_match&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rng</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&#39;inverse_rewrite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">byte_array_and</span><span class="p">(</span><span class="n">byte_array_not</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;mask&#39;</span><span class="p">]),</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;match&#39;</span><span class="p">])</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_next_id</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">priority</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">priority</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">)):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extended_rule</span><span class="p">)</span>
      <span class="n">priority</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="n">extended_rule</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">find_influences</span><span class="p">(</span><span class="n">priority</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_fast_lookup_pointers</span><span class="p">(</span><span class="n">priority</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TF.add_fwd_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.add_fwd_rule">[docs]</a>  <span class="k">def</span> <span class="nf">add_fwd_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">priority</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    * &#39;match&#39;: a bytearray of length self.length describing the header formats that</span>
<span class="sd">    match this rule.</span>
<span class="sd">    * &#39;in_ports&#39;: the list of input port numbers to match on</span>
<span class="sd">    * &#39;out_ports&#39;: the list of output port numbers.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">extended_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&#39;match&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;match&#39;</span><span class="p">])</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;fwd&quot;</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&#39;inverse_match&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&#39;inverse_rewrite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_next_id</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">priority</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">priority</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">)):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extended_rule</span><span class="p">)</span>
      <span class="n">priority</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="n">extended_rule</span><span class="p">)</span>

    <span class="c">#self.find_influences(priority)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_fast_lookup_pointers</span><span class="p">(</span><span class="n">priority</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TF.add_link_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.add_link_rule">[docs]</a>  <span class="k">def</span> <span class="nf">add_link_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">priority</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This is useful for topology transfer fucntions</span>
<span class="sd">    * &#39;in_ports&#39;: the list of input port numbers to match on</span>
<span class="sd">    * &#39;out_port&#39;: the list of output port numbers.</span>
<span class="sd">    WARNING: Use link rule only in Topology Transfer Function. Don&#39;t mix it with other</span>
<span class="sd">    type of rules.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">extended_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;link&quot;</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&#39;inverse_match&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&#39;inverse_rewrite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_next_id</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">priority</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extended_rule</span><span class="p">)</span>
      <span class="n">priority</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="n">extended_rule</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">set_fast_lookup_pointers</span><span class="p">(</span><span class="n">priority</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TF.add_custom_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.add_custom_rule">[docs]</a>  <span class="k">def</span> <span class="nf">add_custom_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">,</span> <span class="n">priority</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add a custom rule. You need to provide a function for finding math</span>
<span class="sd">    and a function for creating output header.</span>
<span class="sd">    rule should have the following entries:</span>
<span class="sd">    * &#39;match&#39;: a pointer to the function for finding if a packet match this rule.</span>
<span class="sd">    the function should accept (headerspace,in_port) as input and returns a list of</span>
<span class="sd">    headerspace objects that match this rule</span>
<span class="sd">    * &#39;transform&#39;: a pointer to a function which outputs a list of (headerspace, list of out_ports)</span>
<span class="sd">    pairs as the output of the rule.</span>
<span class="sd">    * &#39;inv_match&#39;: a pointer to the function for finding if an output packet can be</span>
<span class="sd">    generated by this rule. The function format is like &quot;match&#39;.</span>
<span class="sd">    * &#39;inv_transform&#39;: a pointer to a function which outputs a list of (headerspace,</span>
<span class="sd">    list of in_ports) pairs as the output of the inverse rule.</span>
<span class="sd">    WARNING: use custom rules in a transfer function with only custom rules. Interaction between</span>
<span class="sd">    custom rules and rewrite/fw rules is not defined.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">extended_rule</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;custom&quot;</span>
    <span class="n">extended_rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_next_id</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">priority</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">extended_rule</span><span class="p">)</span>
      <span class="n">priority</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">priority</span><span class="p">,</span> <span class="n">extended_rule</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id_to_rule</span><span class="p">[</span><span class="n">extended_rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">extended_rule</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">custom_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">priority</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="TF.apply_rewrite_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.apply_rewrite_rule">[docs]</a>  <span class="k">def</span> <span class="nf">apply_rewrite_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">applied_rules</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">mod_outports</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;out_ports&quot;</span><span class="p">])</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    if (not self.send_on_receiving_port) and (port in mod_outports):</span>
<span class="sd">        mod_outports.remove(port)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mod_outports</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">[]</span>

    <span class="n">new_hs</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">copy_intersect</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;match&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">new_hs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">]:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">new_hs</span><span class="o">.</span><span class="n">hs_list</span><span class="p">)):</span>
        <span class="n">barr</span> <span class="o">=</span> <span class="n">byte_array_or</span><span class="p">(</span><span class="n">byte_array_and</span><span class="p">(</span><span class="n">new_hs</span><span class="o">.</span><span class="n">hs_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;mask&#39;</span><span class="p">]),</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;rewrite&#39;</span><span class="p">])</span>
        <span class="n">new_hs</span><span class="o">.</span><span class="n">hs_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">barr</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">in_ports</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;affected_by&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">in_ports</span> <span class="ow">and</span> <span class="p">(</span><span class="n">applied_rules</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">r</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">applied_rules</span><span class="p">):</span>
          <span class="n">new_hs</span><span class="o">.</span><span class="n">diff_hs</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">new_hs</span><span class="o">.</span><span class="n">hs_diff</span><span class="p">)):</span>
        <span class="n">barr</span> <span class="o">=</span> <span class="n">byte_array_or</span><span class="p">(</span><span class="n">byte_array_and</span><span class="p">(</span><span class="n">new_hs</span><span class="o">.</span><span class="n">hs_diff</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;mask&#39;</span><span class="p">]),</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;rewrite&#39;</span><span class="p">])</span>
        <span class="n">new_hs</span><span class="o">.</span><span class="n">hs_diff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">barr</span>
      <span class="c">#new_hs.clean_up()</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">new_hs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>
      <span class="n">new_hs</span><span class="o">.</span><span class="n">push_applied_tf_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">],</span><span class="n">port</span><span class="p">)</span>
      <span class="n">applied_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">])</span>
      <span class="k">return</span> <span class="p">[(</span><span class="n">new_hs</span><span class="p">,</span><span class="n">mod_outports</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="TF.apply_fwd_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.apply_fwd_rule">[docs]</a>  <span class="k">def</span> <span class="nf">apply_fwd_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">port</span><span class="p">,</span><span class="n">applied_rules</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">mod_outports</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;out_ports&quot;</span><span class="p">])</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    if (not self.send_on_receiving_port) and (port in mod_outports):</span>
<span class="sd">        mod_outports.remove(port)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mod_outports</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">[]</span>

    <span class="n">new_hs</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">copy_intersect</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;match&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">new_hs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">]:</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">in_ports</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;affected_by&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">in_ports</span> <span class="ow">and</span> <span class="p">(</span><span class="n">applied_rules</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">r</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">applied_rules</span><span class="p">):</span>
          <span class="n">new_hs</span><span class="o">.</span><span class="n">diff_hs</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
      <span class="c">#new_hs.clean_up()</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">new_hs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>
      <span class="n">new_hs</span><span class="o">.</span><span class="n">push_applied_tf_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">],</span><span class="n">port</span><span class="p">)</span>
      <span class="n">applied_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">])</span>
      <span class="k">return</span> <span class="p">[(</span><span class="n">new_hs</span><span class="p">,</span><span class="n">mod_outports</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="TF.apply_link_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.apply_link_rule">[docs]</a>  <span class="k">def</span> <span class="nf">apply_link_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">port</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">]:</span>
      <span class="n">ohs</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
      <span class="n">ohs</span><span class="o">.</span><span class="n">push_applied_tf_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">],</span><span class="n">port</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">[(</span><span class="n">ohs</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;out_ports&#39;</span><span class="p">]))]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="TF.apply_custom_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.apply_custom_rule">[docs]</a>  <span class="k">def</span> <span class="nf">apply_custom_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">port</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">](</span><span class="n">hs</span><span class="p">,</span><span class="n">port</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
        <span class="n">tmp_hp</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;transform&quot;</span><span class="p">](</span><span class="n">match</span><span class="p">,</span><span class="n">port</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">out_hs</span><span class="p">,</span><span class="n">out_ports</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tmp_hp</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">out_hs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out_hs</span><span class="o">.</span><span class="n">push_applied_tf_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">],</span><span class="n">port</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">out_hs</span><span class="p">,</span><span class="n">out_ports</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="TF.T"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.T">[docs]</a>  <span class="k">def</span> <span class="nf">T</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">port</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    returns a list of (hs, list of output ports) as a result of applying transfer function.</span>
<span class="sd">    hs will have A-B format, where A is the intersection of hs and the rule&#39;s match struct</span>
<span class="sd">    and B will be union of match bytes of all the rules that influence on the matching rule.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">applied_rules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rule_set</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c">#TODO: Hack! fix it</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inport_to_rule</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">port</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_table_active</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">hs</span><span class="o">.</span><span class="n">hs_list</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">rule_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inport_to_rule</span><span class="p">[</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">port</span><span class="p">]</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_table_active</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">inport_to_hash_table</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">port</span><span class="p">):</span>
      <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_nibble_indices</span><span class="p">:</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hs</span><span class="o">.</span><span class="n">hs_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">index</span><span class="p">])</span>
      <span class="n">rule_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inport_to_hash_table</span><span class="p">[</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">port</span><span class="p">]</span><span class="o">.</span><span class="n">find_entry</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rule_set</span><span class="p">:</span>
        <span class="c">#check if this rule qualifies for lazy evaluation</span>
      <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lazy_eval_active</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_qualified_for_lazy_eval</span><span class="p">(</span><span class="n">rule</span><span class="p">)):</span>
        <span class="n">lazy_hs</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">lazy_hs</span><span class="o">.</span><span class="n">add_lazy_tf_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">],</span><span class="n">port</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lazy_hs</span><span class="p">,</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;out_ports&quot;</span><span class="p">])</span>
      <span class="c"># link rule</span>
      <span class="k">elif</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;link&quot;</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apply_link_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
      <span class="c"># rewrite rule</span>
      <span class="k">elif</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;rw&quot;</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apply_rewrite_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span><span class="n">applied_rules</span><span class="p">))</span>
      <span class="c"># forward rule</span>
      <span class="k">elif</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;fwd&quot;</span><span class="p">:</span>
        <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apply_fwd_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span><span class="n">applied_rules</span><span class="p">))</span>

    <span class="c"># custom rules</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_rules</span><span class="p">:</span>
      <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apply_custom_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="TF.T_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.T_rule">[docs]</a>  <span class="k">def</span> <span class="nf">T_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule_id</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">port</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Apply rule with id = rule_id to (hs,port)</span>
<span class="sd">    Output is a list of [hs,list_of_out_ports].</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_to_rule</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">rule_id</span><span class="p">):</span>
      <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_to_rule</span><span class="p">[</span><span class="n">rule_id</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;link&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_link_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;rw&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_rewrite_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;fwd&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_fwd_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;custom&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_custom_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="TF.apply_inv_link_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.apply_inv_link_rule">[docs]</a>  <span class="k">def</span> <span class="nf">apply_inv_link_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">port</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">port</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;out_ports&quot;</span><span class="p">]):</span>
      <span class="n">ihs</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
      <span class="n">ihs</span><span class="o">.</span><span class="n">push_applied_tf_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">],</span><span class="n">port</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">[(</span><span class="n">ihs</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;in_ports&#39;</span><span class="p">]))]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="TF.apply_inv_rewrite_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.apply_inv_rewrite_rule">[docs]</a>  <span class="k">def</span> <span class="nf">apply_inv_rewrite_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">port</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_hs</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">copy_intersect</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;inverse_match&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">new_hs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">new_hs</span><span class="o">.</span><span class="n">hs_list</span><span class="p">)):</span>
        <span class="n">barr</span> <span class="o">=</span> <span class="n">byte_array_or</span><span class="p">(</span><span class="n">byte_array_and</span><span class="p">(</span><span class="n">new_hs</span><span class="o">.</span><span class="n">hs_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;mask&#39;</span><span class="p">]),</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;inverse_rewrite&#39;</span><span class="p">])</span>
        <span class="n">new_hs</span><span class="o">.</span><span class="n">hs_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">barr</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">new_hs</span><span class="o">.</span><span class="n">hs_diff</span><span class="p">)):</span>
        <span class="n">barr</span> <span class="o">=</span> <span class="n">byte_array_or</span><span class="p">(</span><span class="n">byte_array_and</span><span class="p">(</span><span class="n">new_hs</span><span class="o">.</span><span class="n">hs_diff</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;mask&#39;</span><span class="p">]),</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;inverse_rewrite&#39;</span><span class="p">])</span>
        <span class="n">new_hs</span><span class="o">.</span><span class="n">hs_diff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">barr</span>
      <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">]:</span>
        <span class="n">next_hs</span> <span class="o">=</span> <span class="n">new_hs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">in_ports</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;affected_by&quot;</span><span class="p">]:</span>
          <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">in_ports</span><span class="p">:</span>
            <span class="n">next_hs</span><span class="o">.</span><span class="n">diff_hs</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">next_hs</span><span class="o">.</span><span class="n">clean_up</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">next_hs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
          <span class="n">next_hs</span><span class="o">.</span><span class="n">push_applied_tf_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">],</span><span class="n">port</span><span class="p">)</span>
          <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">next_hs</span><span class="p">,[</span><span class="n">p</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="TF.apply_inv_fwd_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.apply_inv_fwd_rule">[docs]</a>  <span class="k">def</span> <span class="nf">apply_inv_fwd_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">port</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">new_hs</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">copy_intersect</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&#39;match&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">new_hs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">]:</span>
        <span class="n">next_hs</span> <span class="o">=</span> <span class="n">new_hs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">in_ports</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;affected_by&quot;</span><span class="p">]:</span>
          <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">in_ports</span><span class="p">:</span>
            <span class="n">next_hs</span><span class="o">.</span><span class="n">diff_hs</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">next_hs</span><span class="o">.</span><span class="n">clean_up</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">next_hs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
          <span class="n">next_hs</span><span class="o">.</span><span class="n">push_applied_tf_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">],</span><span class="n">port</span><span class="p">)</span>
          <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">next_hs</span><span class="p">,[</span><span class="n">p</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="TF.apply_inv_custom_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.apply_inv_custom_rule">[docs]</a>  <span class="k">def</span> <span class="nf">apply_inv_custom_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">port</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;inv_match&quot;</span><span class="p">](</span><span class="n">hs</span><span class="p">,</span><span class="n">port</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
      <span class="n">tmp_hp</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;inv_transform&quot;</span><span class="p">](</span><span class="n">match</span><span class="p">,</span><span class="n">port</span><span class="p">)</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">in_hs</span><span class="p">,</span><span class="n">in_ports</span><span class="p">)</span> <span class="ow">in</span> <span class="n">tmp_hp</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">in_hs</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">in_hs</span><span class="o">.</span><span class="n">push_applied_tf_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">],</span><span class="n">port</span><span class="p">)</span>
          <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">in_hs</span><span class="p">,</span><span class="n">in_ports</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="TF.T_inv"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.T_inv">[docs]</a>  <span class="k">def</span> <span class="nf">T_inv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">port</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    returns a list of (hs, list of in_ports) as possible inputs that can cause this (hs,port).</span>
<span class="sd">    The format of hs and returned headerspace object, is like T() method above.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outport_to_rule</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">port</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outport_to_rule</span><span class="p">[</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="n">port</span><span class="p">]:</span>
        <span class="c">#check if rule qualifies for lazy eval</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lazy_eval_active</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_qualified_for_lazy_eval</span><span class="p">(</span><span class="n">rule</span><span class="p">)):</span>
          <span class="n">lazy_hs</span> <span class="o">=</span> <span class="n">hs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
          <span class="n">lazy_hs</span><span class="o">.</span><span class="n">add_lazy_tf_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">],</span><span class="n">port</span><span class="p">)</span>
          <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lazy_hs</span><span class="p">,</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">])</span>
        <span class="c"># link rule</span>
        <span class="k">elif</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;link&quot;</span><span class="p">:</span>
          <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apply_inv_link_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
        <span class="c"># rewrite rule</span>
        <span class="k">elif</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;rw&quot;</span><span class="p">:</span>
          <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apply_inv_rewrite_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
        <span class="c"># forward rules</span>
        <span class="k">elif</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;fwd&quot;</span><span class="p">:</span>
          <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apply_inv_fwd_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

    <span class="c"># custom rules</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_rules</span><span class="p">:</span>
      <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apply_inv_custom_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="TF.T_inv_rule"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.T_inv_rule">[docs]</a>  <span class="k">def</span> <span class="nf">T_inv_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule_id</span><span class="p">,</span><span class="n">hs</span><span class="p">,</span><span class="n">port</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Apply rule with id = rule_id to (hs,port)</span>
<span class="sd">    Output is a list of [hs,list_of_out_ports].</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_to_rule</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">rule_id</span><span class="p">):</span>
      <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_to_rule</span><span class="p">[</span><span class="n">rule_id</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;link&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_inv_link_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;rw&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_inv_rewrite_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;fwd&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_inv_fwd_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
      <span class="k">elif</span> <span class="n">rule</span><span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;custom&quot;</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_inv_custom_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span> <span class="n">hs</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="TF.is_qualified_for_lazy_eval"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.is_qualified_for_lazy_eval">[docs]</a>  <span class="k">def</span> <span class="nf">is_qualified_for_lazy_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rule</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This is a simple version of checking for lazy evaluation.</span>
<span class="sd">    TODO: implement a more complex version that understand packet header rather than</span>
<span class="sd">    just looking at some bit positions</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;action&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;rw&quot;</span><span class="p">:</span>
      <span class="n">no_rewrite_outside_lazy</span> <span class="o">=</span> <span class="bp">True</span>
      <span class="n">one_rewrite_inside_lazy</span> <span class="o">=</span> <span class="bp">False</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;mask&quot;</span><span class="p">])):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lazy_eval_nibbles</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;mask&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0xaa</span><span class="p">:</span>
            <span class="n">one_rewrite_inside_lazy</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;mask&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0xaa</span><span class="p">:</span>
            <span class="n">no_rewrite_outside_lazy</span> <span class="o">=</span> <span class="bp">False</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">no_rewrite_outside_lazy</span> <span class="ow">and</span> <span class="n">one_rewrite_inside_lazy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">False</span>

</div>
<div class="viewcode-block" id="TF.save_object_to_file"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.save_object_to_file">[docs]</a>  <span class="k">def</span> <span class="nf">save_object_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    saves all the non-custom transfer function rules to a file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;=== Saving transfer function to file </span><span class="si">%s</span><span class="s"> ===&quot;</span><span class="o">%</span><span class="nb">file</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">$</span><span class="si">%s</span><span class="s">$</span><span class="si">%d</span><span class="s">$</span><span class="si">%d</span><span class="s">$</span><span class="si">%d</span><span class="s">$</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">prefix_id</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">next_id</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lazy_eval_active</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">send_on_receiving_port</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">nibble</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lazy_eval_nibbles</span><span class="p">:</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">$&quot;</span><span class="o">%</span><span class="n">nibble</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;#</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">$&quot;</span><span class="o">%</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;action&quot;</span><span class="p">])</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">$&quot;</span><span class="o">%</span><span class="nb">list</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">]))</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">$&quot;</span><span class="o">%</span><span class="n">byte_array_to_hs_string</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">]))</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">$&quot;</span><span class="o">%</span><span class="n">byte_array_to_hs_string</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;mask&quot;</span><span class="p">]))</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">$&quot;</span><span class="o">%</span><span class="n">byte_array_to_hs_string</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;rewrite&quot;</span><span class="p">]))</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">$&quot;</span><span class="o">%</span><span class="n">byte_array_to_hs_string</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;inverse_match&quot;</span><span class="p">]))</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">$&quot;</span><span class="o">%</span><span class="n">byte_array_to_hs_string</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;inverse_rewrite&quot;</span><span class="p">]))</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">$&quot;</span><span class="o">%</span><span class="nb">list</span><span class="p">(</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;out_ports&quot;</span><span class="p">]))</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;#&quot;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">ra</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;affected_by&quot;</span><span class="p">]:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">;</span><span class="si">%s</span><span class="s">;</span><span class="si">%s</span><span class="s">#&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">byte_array_to_hs_string</span><span class="p">(</span><span class="n">ra</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">ra</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;$&quot;</span><span class="p">)</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;#&quot;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">io</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;influence_on&quot;</span><span class="p">]:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">#&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">io</span><span class="p">))</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;$</span><span class="si">%s</span><span class="s">$&quot;</span><span class="o">%</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;file&quot;</span><span class="p">])</span>
      <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;line&quot;</span><span class="p">]:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%d</span><span class="s">,&quot;</span><span class="o">%</span><span class="n">ln</span><span class="p">)</span>
      <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;$</span><span class="si">%s</span><span class="s">$</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">%</span><span class="n">rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">])</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;=== Transfer function saved to file </span><span class="si">%s</span><span class="s"> ===&quot;</span><span class="o">%</span><span class="nb">file</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TF.load_object_from_file"><a class="viewcode-back" href="../../../../sts.headerspace.headerspace.html#sts.headerspace.headerspace.tf.TF.load_object_from_file">[docs]</a>  <span class="k">def</span> <span class="nf">load_object_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    load object from file, and replace the current object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;=== Loading transfer function from file </span><span class="si">%s</span><span class="s"> ===&quot;</span><span class="o">%</span><span class="nb">file</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">first_line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">first_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;$&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prefix_id</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">next_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lazy_eval_active</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">lazy_eval_active</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">send_on_receiving_port</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">send_on_receiving_port</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">second_line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">second_line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;$&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lazy_eval_nibbles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
      <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;$&#39;</span><span class="p">)</span>
      <span class="n">new_rule</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="c"># action</span>
      <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;action&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="c"># in_ports</span>
      <span class="n">in_p</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;[]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
      <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">in_p</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
          <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;in_ports&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
      <span class="c"># match</span>
      <span class="n">match</span> <span class="o">=</span> <span class="n">hs_string_to_byte_array</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
      <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;match&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">match</span>
      <span class="c"># mask</span>
      <span class="n">mask</span> <span class="o">=</span> <span class="n">hs_string_to_byte_array</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
      <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span>
      <span class="c"># rewrite</span>
      <span class="n">rewrite</span> <span class="o">=</span> <span class="n">hs_string_to_byte_array</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
      <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;rewrite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rewrite</span>
      <span class="c"># inverse_match</span>
      <span class="n">inverse_match</span> <span class="o">=</span> <span class="n">hs_string_to_byte_array</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
      <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;inverse_match&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inverse_match</span>
      <span class="c"># inverse_rewrite</span>
      <span class="n">inverse_rewrite</span> <span class="o">=</span> <span class="n">hs_string_to_byte_array</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
      <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;inverse_rewrite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inverse_rewrite</span>
      <span class="c"># out_ports</span>
      <span class="n">out_p</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;[]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
      <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;out_ports&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">out_p</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
          <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;out_ports&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
      <span class="c"># affected by</span>
      <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;affected_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">affect_list</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">affect</span> <span class="ow">in</span> <span class="n">affect_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">affect</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
          <span class="n">elems</span> <span class="o">=</span> <span class="n">affect</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
          <span class="n">aff_p</span> <span class="o">=</span> <span class="n">elems</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;[]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
          <span class="n">prts</span> <span class="o">=</span> <span class="p">[]</span>
          <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">aff_p</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
              <span class="n">prts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
          <span class="n">new_affect</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">elems</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">hs_string_to_byte_array</span><span class="p">(</span><span class="n">elems</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">prts</span><span class="p">)</span>
          <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;affected_by&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_affect</span><span class="p">)</span>
      <span class="c"># influence on</span>
      <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;influence_on&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">influence_list</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">influence</span> <span class="ow">in</span> <span class="n">influence_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">influence</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
          <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;influence_on&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">influence</span><span class="p">))</span>
      <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>
      <span class="n">lns</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
      <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;line&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">lns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ln</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
          <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;line&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ln</span><span class="p">))</span>
      <span class="n">new_rule</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
      <span class="c"># Save new rule</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_rule</span><span class="p">)</span>

    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c"># now replace index in affected_by and influence_on fields to the pointer to rules.</span>
    <span class="k">for</span> <span class="n">indx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">)):</span>
      <span class="n">rule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
      <span class="n">influences</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">idex</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;influence_on&quot;</span><span class="p">]:</span>
        <span class="n">influences</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">idex</span><span class="p">])</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;influence_on&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">influences</span>
      <span class="n">affects</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rule</span><span class="p">[</span><span class="s">&quot;affected_by&quot;</span><span class="p">]:</span>
        <span class="n">new_affect</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">affects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_affect</span><span class="p">)</span>
      <span class="n">rule</span><span class="p">[</span><span class="s">&quot;affected_by&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">affects</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">set_fast_lookup_pointers</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;=== Transfer function loaded from file </span><span class="si">%s</span><span class="s"> ===&quot;</span><span class="o">%</span><span class="nb">file</span><span class="p">)</span>
</div>
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">strs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_string</span><span class="p">()</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strs</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">STS 0.1 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Colin Scott.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>