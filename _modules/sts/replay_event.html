<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sts.replay_event &mdash; STS 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="STS 0.1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">STS 0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for sts.replay_event</h1><div class="highlight"><pre>
<span class="c"># Copyright 2011-2013 Colin Scott</span>
<span class="c"># Copyright 2011-2013 Andreas Wundsam</span>
<span class="c"># Copyright 2012-2013 Sam Whitlock</span>
<span class="c">#</span>
<span class="c"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c"># you may not use this file except in compliance with the License.</span>
<span class="c"># You may obtain a copy of the License at:</span>
<span class="c">#</span>
<span class="c">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c">#</span>
<span class="c"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c"># See the License for the specific language governing permissions and</span>
<span class="c"># limitations under the License.</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Classes representing events to be replayed. These events can be serialized to</span>
<span class="sd">events.trace JSON files.</span>

<span class="sd">Note about the JSON events.trace format:</span>

<span class="sd">All events are serialized to JSON with the Event.to_json() method.</span>

<span class="sd">All events have a fingerprint field, which is used to compute functional</span>
<span class="sd">equivalence between events across different replays of the trace.</span>

<span class="sd">The default format of the fingerprint field is a tuple (event class name,).</span>

<span class="sd">The specific format of the fingerprint field is documented in each class&#39;</span>
<span class="sd">fingerprint() method.</span>

<span class="sd">The format of other additional fields is documented in</span>
<span class="sd">each event&#39;s __init__() method.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">sts.util.console</span> <span class="kn">import</span> <span class="n">msg</span>
<span class="kn">from</span> <span class="nn">sts.entities</span> <span class="kn">import</span> <span class="n">Link</span>
<span class="kn">from</span> <span class="nn">sts.god_scheduler</span> <span class="kn">import</span> <span class="n">PendingReceive</span><span class="p">,</span> <span class="n">PendingSend</span>
<span class="kn">from</span> <span class="nn">sts.dataplane_traces.trace</span> <span class="kn">import</span> <span class="n">DataplaneEvent</span>
<span class="kn">from</span> <span class="nn">sts.fingerprints.messages</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">invariant_checker</span> <span class="kn">import</span> <span class="n">InvariantChecker</span>
<span class="kn">from</span> <span class="nn">config.invariant_checks</span> <span class="kn">import</span> <span class="n">name_to_invariant_check</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">marshal</span>
<span class="kn">import</span> <span class="nn">types</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<span class="kn">from</span> <span class="nn">sts.syncproto.base</span> <span class="kn">import</span> <span class="n">SyncTime</span>
<span class="kn">from</span> <span class="nn">pox.lib.util</span> <span class="kn">import</span> <span class="n">TimeoutError</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&quot;events&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="dictify_fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.dictify_fingerprint">[docs]</a><span class="k">def</span> <span class="nf">dictify_fingerprint</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">):</span>
  <span class="c"># Hack: convert Fingerprint objects into Fingerprint.to_dict()</span>
  <span class="n">mutable</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mutable</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mutable</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Fingerprint</span><span class="p">):</span>
      <span class="n">mutable</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mutable</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
  <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">mutable</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Event"><a class="viewcode-back" href="../../sts.html#sts.replay_event.Event">[docs]</a><span class="k">class</span> <span class="nc">Event</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Superclass for all event types. &#39;&#39;&#39;</span>
  <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span>

  <span class="c"># Create unique labels for events</span>
  <span class="n">_label_gen</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="c"># Ensure globally unique labels</span>
  <span class="n">_all_label_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<div class="viewcode-block" id="Event.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.Event.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;e&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dependent_labels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">prunable</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">label_id</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">_label_gen</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
      <span class="n">label</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">label_id</span><span class="p">)</span>
      <span class="k">while</span> <span class="n">label_id</span> <span class="ow">in</span> <span class="n">Event</span><span class="o">.</span><span class="n">_all_label_ids</span><span class="p">:</span>
        <span class="n">label_id</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">_label_gen</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">label_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="c"># TODO(cs): compress time for interactive mode?</span>
      <span class="n">time</span> <span class="o">=</span> <span class="n">SyncTime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
    <span class="n">Event</span><span class="o">.</span><span class="n">_all_label_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">label</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">round</span> <span class="o">=</span> <span class="nb">round</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span>
    <span class="c"># Add on dependent labels to appease log_processing.superlog_parser.</span>
    <span class="c"># TODO(cs): Replayer shouldn&#39;t depend on superlog_parser</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dependent_labels</span> <span class="o">=</span> <span class="n">dependent_labels</span> <span class="k">if</span> <span class="n">dependent_labels</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="c"># Whether this event should be prunable by MCSFinder. Initialization</span>
    <span class="c"># inputs are not pruned.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prunable</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="c"># Whether the (internal) event timed out in the most recent round</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timed_out</span> <span class="o">=</span> <span class="bp">False</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="Event.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.Event.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; All events must have a fingerprint. Fingerprints are used to compute</span>
<span class="sd">    functional equivalence. &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,)</span>
</div>
  <span class="nd">@abc.abstractmethod</span>
<div class="viewcode-block" id="Event.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.Event.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Executes a single `round&#39;. Returns a boolean that is true if the</span>
<span class="sd">    Replayer may continue to the next Event, otherwise proceed() again</span>
<span class="sd">    later.&#39;&#39;&#39;</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Event.to_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.Event.to_json">[docs]</a>  <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Convert the event to json format &#39;&#39;&#39;</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
    <span class="n">fields</span><span class="p">[</span><span class="s">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
    <span class="c"># fingerprints are accessed through @property, not in __dict__:</span>
    <span class="n">fields</span><span class="p">[</span><span class="s">&#39;fingerprint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dictify_fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;_fingerprint&#39;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
      <span class="k">del</span> <span class="n">fields</span><span class="p">[</span><span class="s">&#39;_fingerprint&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
</div>
  <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># Assumption: labels are unique</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">__hash__</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="c"># Assumption: labels are unique</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">label</span>

  <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span>

  <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">label</span> \
            <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s</span>

<span class="c"># -------------------------------------------------------- #</span>
<span class="c"># Semi-abstract classes for internal and external events   #</span>
<span class="c"># -------------------------------------------------------- #</span>
</div>
<div class="viewcode-block" id="InternalEvent"><a class="viewcode-back" href="../../sts.html#sts.replay_event.InternalEvent">[docs]</a><span class="k">class</span> <span class="nc">InternalEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;An InternalEvent is one that happens within the controller(s) under</span>
<span class="sd">  simulation. Derivatives of this class verify that the internal event has</span>
<span class="sd">  occured during replay in its proceed method before it returns.&#39;&#39;&#39;</span>
<div class="viewcode-block" id="InternalEvent.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.InternalEvent.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
               <span class="n">prunable</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">InternalEvent</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                                        <span class="n">prunable</span><span class="o">=</span><span class="n">prunable</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timeout_disallowed</span> <span class="o">=</span> <span class="n">timeout_disallowed</span>
</div>
<div class="viewcode-block" id="InternalEvent.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.InternalEvent.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="c"># There might be nothing happening for certain internal events, so default</span>
    <span class="c"># to just doing nothing for proceed (i.e. proceeding automatically).</span>
    <span class="k">pass</span>
</div>
<div class="viewcode-block" id="InternalEvent.disallow_timeouts"><a class="viewcode-back" href="../../sts.html#sts.replay_event.InternalEvent.disallow_timeouts">[docs]</a>  <span class="k">def</span> <span class="nf">disallow_timeouts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">timeout_disallowed</span> <span class="o">=</span> <span class="bp">True</span>
</div></div>
<div class="viewcode-block" id="InputEvent"><a class="viewcode-back" href="../../sts.html#sts.replay_event.InputEvent">[docs]</a><span class="k">class</span> <span class="nc">InputEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;An InputEvents is an event that the simulator injects into the simulation.</span>

<span class="sd">  Each InputEvent has a list of dependent InternalEvents that it takes in its</span>
<span class="sd">  constructor. This enables us to properly prune events.</span>

<span class="sd">  `InputEvents&#39; may also be referred to as &#39;external</span>
<span class="sd">  events&#39;, elsewhere in documentation or code.&#39;&#39;&#39;</span>
<div class="viewcode-block" id="InputEvent.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.InputEvent.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dependent_labels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">prunable</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                                     <span class="n">dependent_labels</span><span class="o">=</span><span class="n">dependent_labels</span><span class="p">,</span>
                                     <span class="n">prunable</span><span class="o">=</span><span class="n">prunable</span><span class="p">)</span>

<span class="c"># --------------------------------- #</span>
<span class="c">#  Concrete classes of InputEvents  #</span>
<span class="c"># --------------------------------- #</span>
</div></div>
<div class="viewcode-block" id="assert_fields_exist"><a class="viewcode-back" href="../../sts.html#sts.replay_event.assert_fields_exist">[docs]</a><span class="k">def</span> <span class="nf">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; assert that the fields exist in json_hash &#39;&#39;&#39;</span>
  <span class="n">fields</span> <span class="o">=</span> <span class="n">args</span>
  <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">json_hash</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Field </span><span class="si">%s</span><span class="s"> not in json_hash </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="extract_label_time"><a class="viewcode-back" href="../../sts.html#sts.replay_event.extract_label_time">[docs]</a><span class="k">def</span> <span class="nf">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
  <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;label&#39;</span><span class="p">,</span> <span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="s">&#39;round&#39;</span><span class="p">)</span>
  <span class="n">label</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;label&#39;</span><span class="p">]</span>
  <span class="n">time</span> <span class="o">=</span> <span class="n">SyncTime</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
  <span class="nb">round</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;round&#39;</span><span class="p">]</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SwitchFailure"><a class="viewcode-back" href="../../sts.html#sts.replay_event.SwitchFailure">[docs]</a><span class="k">class</span> <span class="nc">SwitchFailure</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Crashes a switch, by disconnecting its TCP connection with the</span>
<span class="sd">  controller(s).&#39;&#39;&#39;</span>
<div class="viewcode-block" id="SwitchFailure.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.SwitchFailure.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dpid</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - dpid: unique integer identifier of the switch.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">SwitchFailure</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dpid</span> <span class="o">=</span> <span class="n">dpid</span>
</div>
<div class="viewcode-block" id="SwitchFailure.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.SwitchFailure.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">software_switch</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">get_switch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dpid</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">crash_switch</span><span class="p">(</span><span class="n">software_switch</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SwitchFailure.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.SwitchFailure.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;dpid&#39;</span><span class="p">)</span>
    <span class="n">dpid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;dpid&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">SwitchFailure</span><span class="p">(</span><span class="n">dpid</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="SwitchFailure.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.SwitchFailure.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Fingerprint tuple format: (class name, dpid) &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dpid</span><span class="p">,)</span>
</div></div>
<div class="viewcode-block" id="SwitchRecovery"><a class="viewcode-back" href="../../sts.html#sts.replay_event.SwitchRecovery">[docs]</a><span class="k">class</span> <span class="nc">SwitchRecovery</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Recovers a crashed switch, by reconnecting its TCP connection with the</span>
<span class="sd">  controller(s).&#39;&#39;&#39;</span>
<div class="viewcode-block" id="SwitchRecovery.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.SwitchRecovery.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dpid</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - dpid: unique integer identifier of the switch.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">SwitchRecovery</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dpid</span> <span class="o">=</span> <span class="n">dpid</span>
</div>
<div class="viewcode-block" id="SwitchRecovery.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.SwitchRecovery.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">software_switch</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">get_switch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dpid</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">down_controller_ids</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">cid</span><span class="p">,</span>
                                <span class="n">simulation</span><span class="o">.</span><span class="n">controller_manager</span><span class="o">.</span><span class="n">down_controllers</span><span class="p">)</span>

      <span class="n">simulation</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">recover_switch</span><span class="p">(</span><span class="n">software_switch</span><span class="p">,</span>
                                         <span class="n">down_controller_ids</span><span class="o">=</span><span class="n">down_controller_ids</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">TimeoutError</span><span class="p">:</span>
      <span class="c"># Controller is down... Hopefully control flow will notice soon enough</span>
      <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;Timed out on </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="SwitchRecovery.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.SwitchRecovery.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;dpid&#39;</span><span class="p">)</span>
    <span class="n">dpid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;dpid&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">SwitchRecovery</span><span class="p">(</span><span class="n">dpid</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="SwitchRecovery.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.SwitchRecovery.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Fingerprint tuple format: (class name, dpid) &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dpid</span><span class="p">,)</span>
</div></div>
<div class="viewcode-block" id="get_link"><a class="viewcode-back" href="../../sts.html#sts.replay_event.get_link">[docs]</a><span class="k">def</span> <span class="nf">get_link</span><span class="p">(</span><span class="n">link_event</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
  <span class="n">start_software_switch</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">get_switch</span><span class="p">(</span><span class="n">link_event</span><span class="o">.</span><span class="n">start_dpid</span><span class="p">)</span>
  <span class="n">end_software_switch</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">get_switch</span><span class="p">(</span><span class="n">link_event</span><span class="o">.</span><span class="n">end_dpid</span><span class="p">)</span>
  <span class="n">link</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="n">start_software_switch</span><span class="p">,</span> <span class="n">link_event</span><span class="o">.</span><span class="n">start_port_no</span><span class="p">,</span>
              <span class="n">end_software_switch</span><span class="p">,</span> <span class="n">link_event</span><span class="o">.</span><span class="n">end_port_no</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">link</span>
</div>
<div class="viewcode-block" id="LinkFailure"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkFailure">[docs]</a><span class="k">class</span> <span class="nc">LinkFailure</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Cuts a link between switches. This causes the switch to send an</span>
<span class="sd">  ofp_port_status message to its parent(s). All packets forwarded over</span>
<span class="sd">  this link will be dropped until a LinkRecovery occurs.&#39;&#39;&#39;</span>
<div class="viewcode-block" id="LinkFailure.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkFailure.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_dpid</span><span class="p">,</span> <span class="n">start_port_no</span><span class="p">,</span> <span class="n">end_dpid</span><span class="p">,</span> <span class="n">end_port_no</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - start_dpid: unique integer identifier of the first switch connected to the link.</span>
<span class="sd">     - start_port_no: integer port number of the start switch&#39;s port.</span>
<span class="sd">     - end_dpid: unique integer identifier of the second switch connected to the link.</span>
<span class="sd">     - end_port_no: integer port number of the end switch&#39;s port to be created.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">LinkFailure</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_dpid</span> <span class="o">=</span> <span class="n">start_dpid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_port_no</span> <span class="o">=</span> <span class="n">start_port_no</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_dpid</span> <span class="o">=</span> <span class="n">end_dpid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_port_no</span> <span class="o">=</span> <span class="n">end_port_no</span>
</div>
<div class="viewcode-block" id="LinkFailure.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkFailure.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">link</span> <span class="o">=</span> <span class="n">get_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">sever_link</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="LinkFailure.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkFailure.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;start_dpid&#39;</span><span class="p">,</span> <span class="s">&#39;start_port_no&#39;</span><span class="p">,</span> <span class="s">&#39;end_dpid&#39;</span><span class="p">,</span>
                        <span class="s">&#39;end_port_no&#39;</span><span class="p">)</span>
    <span class="n">start_dpid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;start_dpid&#39;</span><span class="p">])</span>
    <span class="n">start_port_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;start_port_no&#39;</span><span class="p">])</span>
    <span class="n">end_dpid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;end_dpid&#39;</span><span class="p">])</span>
    <span class="n">end_port_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;end_port_no&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">LinkFailure</span><span class="p">(</span><span class="n">start_dpid</span><span class="p">,</span> <span class="n">start_port_no</span><span class="p">,</span> <span class="n">end_dpid</span><span class="p">,</span> <span class="n">end_port_no</span><span class="p">,</span>
                       <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="LinkFailure.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkFailure.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Fingerprint tuple format:</span>
<span class="sd">    (class name, start dpid, start port_no, end dpid, end port_no) &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_dpid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_port_no</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_dpid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_port_no</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="LinkRecovery"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkRecovery">[docs]</a><span class="k">class</span> <span class="nc">LinkRecovery</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Recovers a failed link between switches. This causes the switch to send an</span>
<span class="sd">  ofp_port_status message to its parent(s). &#39;&#39;&#39;</span>
<div class="viewcode-block" id="LinkRecovery.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkRecovery.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_dpid</span><span class="p">,</span> <span class="n">start_port_no</span><span class="p">,</span> <span class="n">end_dpid</span><span class="p">,</span> <span class="n">end_port_no</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - start_dpid: unique integer identifier of the first switch connected to the link.</span>
<span class="sd">     - start_port_no: integer port number of the start switch&#39;s port.</span>
<span class="sd">     - end_dpid: unique integer identifier of the second switch connected to the link.</span>
<span class="sd">     - end_port_no: integer port number of the end switch&#39;s port to be created.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">LinkRecovery</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_dpid</span> <span class="o">=</span> <span class="n">start_dpid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">start_port_no</span> <span class="o">=</span> <span class="n">start_port_no</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_dpid</span> <span class="o">=</span> <span class="n">end_dpid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">end_port_no</span> <span class="o">=</span> <span class="n">end_port_no</span>
</div>
<div class="viewcode-block" id="LinkRecovery.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkRecovery.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">link</span> <span class="o">=</span> <span class="n">get_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">repair_link</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="LinkRecovery.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkRecovery.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;start_dpid&#39;</span><span class="p">,</span> <span class="s">&#39;start_port_no&#39;</span><span class="p">,</span> <span class="s">&#39;end_dpid&#39;</span><span class="p">,</span>
                        <span class="s">&#39;end_port_no&#39;</span><span class="p">)</span>
    <span class="n">start_dpid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;start_dpid&#39;</span><span class="p">])</span>
    <span class="n">start_port_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;start_port_no&#39;</span><span class="p">])</span>
    <span class="n">end_dpid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;end_dpid&#39;</span><span class="p">])</span>
    <span class="n">end_port_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;end_port_no&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">LinkRecovery</span><span class="p">(</span><span class="n">start_dpid</span><span class="p">,</span> <span class="n">start_port_no</span><span class="p">,</span> <span class="n">end_dpid</span><span class="p">,</span> <span class="n">end_port_no</span><span class="p">,</span>
                        <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="LinkRecovery.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkRecovery.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Fingerprint tuple format:</span>
<span class="sd">    (class name, start dpid, start port, end dpid, end port)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_dpid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_port_no</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_dpid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_port_no</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="ControllerFailure"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerFailure">[docs]</a><span class="k">class</span> <span class="nc">ControllerFailure</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Kills a controller process with `kill -9`&#39;&#39;&#39;</span>
<div class="viewcode-block" id="ControllerFailure.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerFailure.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - controller_id: unique string label for the controller to be killed.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ControllerFailure</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span> <span class="o">=</span> <span class="n">controller_id</span>
</div>
<div class="viewcode-block" id="ControllerFailure.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerFailure.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">controller</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">controller_manager</span><span class="o">.</span><span class="n">get_controller</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">controller_manager</span><span class="o">.</span><span class="n">kill_controller</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ControllerFailure.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerFailure.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="s">&#39;controller_id&#39;</span><span class="p">)</span>
    <span class="n">controller_id</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;controller_id&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ControllerFailure</span><span class="p">(</span><span class="n">controller_id</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ControllerFailure.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerFailure.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Fingerprint tuple format: (class name, controller id) &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="ControllerRecovery"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerRecovery">[docs]</a><span class="k">class</span> <span class="nc">ControllerRecovery</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Reboots a crashed controller by reinvoking its original command line</span>
<span class="sd">  parameters&#39;&#39;&#39;</span>
<div class="viewcode-block" id="ControllerRecovery.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerRecovery.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - controller_id: unique string label for the controller.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ControllerRecovery</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span> <span class="o">=</span> <span class="n">controller_id</span>
</div>
<div class="viewcode-block" id="ControllerRecovery.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerRecovery.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">controller</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">controller_manager</span><span class="o">.</span><span class="n">get_controller</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">)</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">controller_manager</span><span class="o">.</span><span class="n">reboot_controller</span><span class="p">(</span><span class="n">controller</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ControllerRecovery.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerRecovery.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="s">&#39;controller_id&#39;</span><span class="p">)</span>
    <span class="n">controller_id</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;controller_id&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ControllerFailure</span><span class="p">(</span><span class="n">controller_id</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ControllerRecovery.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerRecovery.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Fingerprint tuple format: (class name, controller id) &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="HostMigration"><a class="viewcode-back" href="../../sts.html#sts.replay_event.HostMigration">[docs]</a><span class="k">class</span> <span class="nc">HostMigration</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Migrates a host from one location in network to another. Creates a new</span>
<span class="sd">  virtual port on the new switch, and takes down the old port on the old switch.</span>
<span class="sd">  &#39;&#39;&#39;</span>
<div class="viewcode-block" id="HostMigration.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.HostMigration.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_ingress_dpid</span><span class="p">,</span> <span class="n">old_ingress_port_no</span><span class="p">,</span>
               <span class="n">new_ingress_dpid</span><span class="p">,</span> <span class="n">new_ingress_port_no</span><span class="p">,</span> <span class="n">host_id</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - old_ingress_dpid: unique integer identifier of the ingress switch the host is</span>
<span class="sd">       moving away from.</span>
<span class="sd">     - old_ingress_port_no: integer identifier of the port the host is moving</span>
<span class="sd">       away from.</span>
<span class="sd">     - new_ingress_dpid: unique integer identifier of the ingress switch the host is</span>
<span class="sd">       moving to.</span>
<span class="sd">     - new_ingress_port_no: integer identifier of the port the host is moving</span>
<span class="sd">       to.</span>
<span class="sd">     - host_id: unique integer identifier of the host.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">HostMigration</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">old_ingress_dpid</span> <span class="o">=</span> <span class="n">old_ingress_dpid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">old_ingress_port_no</span> <span class="o">=</span> <span class="n">old_ingress_port_no</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">new_ingress_dpid</span> <span class="o">=</span> <span class="n">new_ingress_dpid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">new_ingress_port_no</span> <span class="o">=</span>  <span class="n">new_ingress_port_no</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">host_id</span> <span class="o">=</span> <span class="n">host_id</span>
</div>
<div class="viewcode-block" id="HostMigration.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.HostMigration.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">migrate_host</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_ingress_dpid</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">old_ingress_port_no</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">new_ingress_dpid</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">new_ingress_port_no</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="HostMigration.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.HostMigration.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;old_ingress_dpid&#39;</span><span class="p">,</span> <span class="s">&#39;old_ingress_port_no&#39;</span><span class="p">,</span>
                        <span class="s">&#39;new_ingress_dpid&#39;</span><span class="p">,</span> <span class="s">&#39;new_ingress_port_no&#39;</span><span class="p">,</span> <span class="s">&#39;host_id&#39;</span><span class="p">)</span>
    <span class="n">old_ingress_dpid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;old_ingress_dpid&#39;</span><span class="p">])</span>
    <span class="n">old_ingress_port_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;old_ingress_port_no&#39;</span><span class="p">])</span>
    <span class="n">new_ingress_dpid</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;new_ingress_dpid&#39;</span><span class="p">])</span>
    <span class="n">new_ingress_port_no</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;new_ingress_port_no&#39;</span><span class="p">])</span>
    <span class="n">host_id</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;host_id&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">HostMigration</span><span class="p">(</span><span class="n">old_ingress_dpid</span><span class="p">,</span> <span class="n">old_ingress_port_no</span><span class="p">,</span>
                         <span class="n">new_ingress_dpid</span><span class="p">,</span> <span class="n">new_ingress_port_no</span><span class="p">,</span>
                         <span class="n">host_id</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="HostMigration.old_location"><a class="viewcode-back" href="../../sts.html#sts.replay_event.HostMigration.old_location">[docs]</a>  <span class="k">def</span> <span class="nf">old_location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_ingress_dpid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_ingress_port_no</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="HostMigration.new_location"><a class="viewcode-back" href="../../sts.html#sts.replay_event.HostMigration.new_location">[docs]</a>  <span class="k">def</span> <span class="nf">new_location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_ingress_dpid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_ingress_port_no</span><span class="p">)</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="HostMigration.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.HostMigration.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Fingerprint tuple format:</span>
<span class="sd">    (class name, old dpid, old port, new dpid, new port, host id) &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">old_ingress_dpid</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">old_ingress_port_no</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_ingress_dpid</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new_ingress_port_no</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">host_id</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="PolicyChange"><a class="viewcode-back" href="../../sts.html#sts.replay_event.PolicyChange">[docs]</a><span class="k">class</span> <span class="nc">PolicyChange</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Not currently supported &#39;&#39;&#39;</span>
<div class="viewcode-block" id="PolicyChange.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.PolicyChange.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">PolicyChange</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">request_type</span> <span class="o">=</span> <span class="n">request_type</span>
</div>
<div class="viewcode-block" id="PolicyChange.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.PolicyChange.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="c"># TODO(cs): implement me, and add PolicyChanges to Fuzzer</span>
    <span class="k">pass</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="PolicyChange.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.PolicyChange.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;request_type&#39;</span><span class="p">)</span>
    <span class="n">request_type</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;request_type&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">PolicyChange</span><span class="p">(</span><span class="n">request_type</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="TrafficInjection"><a class="viewcode-back" href="../../sts.html#sts.replay_event.TrafficInjection">[docs]</a><span class="k">class</span> <span class="nc">TrafficInjection</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Injects a dataplane packet into the network at the given host&#39;s access link &#39;&#39;&#39;</span>
<div class="viewcode-block" id="TrafficInjection.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.TrafficInjection.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dp_event</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">host_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">prunable</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - dp_event: DataplaneEvent object encapsulating the packet contents and the</span>
<span class="sd">       access link.</span>
<span class="sd">     - host_id: unique integer label identifying the host that generated the</span>
<span class="sd">       packet.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">     - prunable: whether this input event can be pruned during delta</span>
<span class="sd">       debugging.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">TrafficInjection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                                           <span class="n">prunable</span><span class="o">=</span><span class="n">prunable</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dp_event</span> <span class="o">=</span> <span class="n">dp_event</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">host_id</span> <span class="o">=</span> <span class="n">host_id</span>
</div>
<div class="viewcode-block" id="TrafficInjection.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.TrafficInjection.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="c"># If dp_event is None, backwards compatibility</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp_event</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">simulation</span><span class="o">.</span><span class="n">dataplane_trace</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;No dataplane trace specified!&quot;</span><span class="p">)</span>
      <span class="n">simulation</span><span class="o">.</span><span class="n">dataplane_trace</span><span class="o">.</span><span class="n">inject_trace_event</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">host</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">link_tracker</span>\
                       <span class="o">.</span><span class="n">interface2access_link</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dp_event</span><span class="o">.</span><span class="n">interface</span><span class="p">]</span><span class="o">.</span><span class="n">host</span>
      <span class="n">host</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dp_event</span><span class="o">.</span><span class="n">interface</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp_event</span><span class="o">.</span><span class="n">packet</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="TrafficInjection.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.TrafficInjection.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Fingerprint tuple format: (class name, dp event, host_id)</span>
<span class="sd">    The format of dp event is:</span>
<span class="sd">    {&quot;interface&quot;: HostInterface.to_json(), &quot;packet&quot;: base 64 encoded packet contents}</span>
<span class="sd">    See entities.py for the HostInterface json format.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp_event</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">host_id</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TrafficInjection.to_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.TrafficInjection.to_json">[docs]</a>  <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
    <span class="n">fields</span><span class="p">[</span><span class="s">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
    <span class="n">fields</span><span class="p">[</span><span class="s">&#39;dp_event&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp_event</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
    <span class="n">fields</span><span class="p">[</span><span class="s">&#39;fingerprint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dp_event</span><span class="o">.</span><span class="n">to_json</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TrafficInjection.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.TrafficInjection.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">prunable</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="s">&#39;prunable&#39;</span> <span class="ow">in</span> <span class="n">json_hash</span><span class="p">:</span>
      <span class="n">prunable</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;prunable&#39;</span><span class="p">]</span>
    <span class="n">dp_event</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="s">&#39;dp_event&#39;</span> <span class="ow">in</span> <span class="n">json_hash</span><span class="p">:</span>
      <span class="n">dp_event</span> <span class="o">=</span> <span class="n">DataplaneEvent</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;dp_event&#39;</span><span class="p">])</span>
    <span class="n">host_id</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="s">&#39;host_id&#39;</span> <span class="ow">in</span> <span class="n">json_hash</span><span class="p">:</span>
      <span class="n">host_id</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;host_id&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">TrafficInjection</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">dp_event</span><span class="o">=</span><span class="n">dp_event</span><span class="p">,</span> <span class="n">host_id</span><span class="o">=</span><span class="n">host_id</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">prunable</span><span class="o">=</span><span class="n">prunable</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="WaitTime"><a class="viewcode-back" href="../../sts.html#sts.replay_event.WaitTime">[docs]</a><span class="k">class</span> <span class="nc">WaitTime</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Causes the simulation to sleep for the specified number of seconds.</span>
<span class="sd">  Controller processes continue running during this time.&#39;&#39;&#39;</span>
<div class="viewcode-block" id="WaitTime.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.WaitTime.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wait_time</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - wait_time: float representing how long to sleep in seconds.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">WaitTime</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wait_time</span> <span class="o">=</span> <span class="n">wait_time</span>
</div>
<div class="viewcode-block" id="WaitTime.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.WaitTime.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;WaitTime: pausing simulation for </span><span class="si">%f</span><span class="s"> seconds&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_time</span><span class="p">))</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_time</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="WaitTime.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.WaitTime.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;wait_time&#39;</span><span class="p">)</span>
    <span class="n">wait_time</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;wait_time&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">WaitTime</span><span class="p">(</span><span class="n">wait_time</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="CheckInvariants"><a class="viewcode-back" href="../../sts.html#sts.replay_event.CheckInvariants">[docs]</a><span class="k">class</span> <span class="nc">CheckInvariants</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Causes the simulation to pause itself and check the given invariant before</span>
<span class="sd">  proceeding. &#39;&#39;&#39;</span>
<div class="viewcode-block" id="CheckInvariants.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.CheckInvariants.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">invariant_check_name</span><span class="o">=</span><span class="s">&quot;InvariantChecker.check_correspondence&quot;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">     - invariant_check_name: unique name of the invariant to be checked. See</span>
<span class="sd">       config.invariant_checks for an exhaustive list of possible invariant</span>
<span class="sd">       checks.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">CheckInvariants</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="c"># For backwards compatibility.. (invariants used to be specified as</span>
    <span class="c"># marshalled functions, not invariant check names)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">legacy_invariant_check</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">invariant_check_name</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_invariant_check</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">invariant_check</span> <span class="o">=</span> <span class="n">invariant_check_name</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="c"># Otherwise, invariant check is specified as a name</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">invariant_check_name</span> <span class="o">=</span> <span class="n">invariant_check_name</span>
      <span class="k">if</span> <span class="n">invariant_check_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name_to_invariant_check</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;&#39;&#39;Unknown invariant check </span><span class="si">%s</span><span class="s">.</span><span class="se">\n</span><span class="s">&#39;&#39;&#39;</span>
                         <span class="sd">&#39;&#39;&#39;Invariant check name must be defined in config.invariant_checks&#39;&#39;&#39;</span><span class="p">,</span>
                         <span class="n">invariant_check_name</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">invariant_check</span> <span class="o">=</span> <span class="n">name_to_invariant_check</span><span class="p">[</span><span class="n">invariant_check_name</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="CheckInvariants.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.CheckInvariants.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">violations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invariant_check</span><span class="p">(</span><span class="n">simulation</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">NameError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;&#39;&#39;Closures are unsupported for invariant check &#39;&#39;&#39;</span>
                       <span class="sd">&#39;&#39;&#39;functions.\n Use dynamic imports inside of your &#39;&#39;&#39;</span>
                       <span class="sd">&#39;&#39;&#39;invariant check code and define all globals &#39;&#39;&#39;</span>
                       <span class="sd">&#39;&#39;&#39;locally.\n NameError: %s&#39;&#39;&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">violations</span> <span class="o">!=</span> <span class="p">[]:</span>
      <span class="n">msg</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s">&quot;The following correctness violations occurred!: </span><span class="si">%s</span><span class="s">&quot;</span>
               <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">violations</span><span class="p">))</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">simulation</span><span class="p">,</span> <span class="s">&quot;fail_to_interactive&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">simulation</span><span class="o">.</span><span class="n">fail_to_interactive</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyboardInterrupt</span><span class="p">(</span><span class="s">&quot;fail to interactive&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">msg</span><span class="o">.</span><span class="n">interactive</span><span class="p">(</span><span class="s">&quot;No correctness violations!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="CheckInvariants.to_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.CheckInvariants.to_json">[docs]</a>  <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
    <span class="n">fields</span><span class="p">[</span><span class="s">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">legacy_invariant_check</span><span class="p">:</span>
      <span class="n">fields</span><span class="p">[</span><span class="s">&#39;invariant_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">marshal</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">invariant_check</span><span class="o">.</span><span class="n">func_code</span><span class="p">)</span>\
                                         <span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;base64&#39;</span><span class="p">)</span>
      <span class="n">fields</span><span class="p">[</span><span class="s">&#39;invariant_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invariant_check</span><span class="o">.</span><span class="n">__name__</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">fields</span><span class="p">[</span><span class="s">&#39;invariant_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invariant_check_name</span>
      <span class="n">fields</span><span class="p">[</span><span class="s">&#39;invariant_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">fields</span><span class="p">[</span><span class="s">&#39;fingerprint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;N/A&quot;</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="CheckInvariants.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.CheckInvariants.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">invariant_check_name</span> <span class="o">=</span> <span class="s">&quot;InvariantChecker.check_connectivity&quot;</span>
    <span class="k">if</span> <span class="s">&#39;invariant_name&#39;</span> <span class="ow">in</span> <span class="n">json_hash</span><span class="p">:</span>
      <span class="n">invariant_check_name</span>  <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;invariant_name&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="s">&#39;invariant_check&#39;</span> <span class="ow">in</span> <span class="n">json_hash</span><span class="p">:</span>
      <span class="c"># Legacy code (marshalled function)</span>
      <span class="c"># Assumes that the closure is empty</span>
      <span class="n">code</span> <span class="o">=</span> <span class="n">marshal</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;invariant_check&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;base64&#39;</span><span class="p">))</span>
      <span class="n">invariant_check_name</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">FunctionType</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">CheckInvariants</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span>
                           <span class="n">invariant_check_name</span><span class="o">=</span><span class="n">invariant_check_name</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="ControlChannelBlock"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlChannelBlock">[docs]</a><span class="k">class</span> <span class="nc">ControlChannelBlock</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Simulates delay between switches and controllers by temporarily</span>
<span class="sd">  queuing all messages sent on the switch&lt;-&gt;controller TCP connection. No</span>
<span class="sd">  messages will be sent over the connection until a ControlChannelUnblock</span>
<span class="sd">  occurs. &#39;&#39;&#39;</span>
<div class="viewcode-block" id="ControlChannelBlock.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlChannelBlock.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dpid</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - dpid: unique integer identifier of the switch.</span>
<span class="sd">     - controller_id: unique string label for the controller.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ControlChannelBlock</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dpid</span> <span class="o">=</span> <span class="n">dpid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span> <span class="o">=</span> <span class="n">controller_id</span>
</div>
<div class="viewcode-block" id="ControlChannelBlock.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlChannelBlock.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">switch</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">get_switch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dpid</span><span class="p">)</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">switch</span><span class="o">.</span><span class="n">get_connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">connection</span><span class="o">.</span><span class="n">io_worker</span><span class="o">.</span><span class="n">currently_blocked</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Expected channel </span><span class="si">%s</span><span class="s"> to not be blocked&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">connection</span><span class="p">))</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">io_worker</span><span class="o">.</span><span class="n">block</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ControlChannelBlock.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlChannelBlock.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Fingerprint tuple format: (class name, dpid, controller id)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dpid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">)</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ControlChannelBlock.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlChannelBlock.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;dpid&#39;</span><span class="p">,</span> <span class="s">&#39;controller_id&#39;</span><span class="p">)</span>
    <span class="n">dpid</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;dpid&#39;</span><span class="p">]</span>
    <span class="n">controller_id</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;controller_id&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ControlChannelBlock</span><span class="p">(</span><span class="n">dpid</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="ControlChannelUnblock"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlChannelUnblock">[docs]</a><span class="k">class</span> <span class="nc">ControlChannelUnblock</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Unblocks the control channel delay triggered by a ControlChannelUnblock.</span>
<span class="sd">  All queued messages will be sent.&#39;&#39;&#39;</span>
<div class="viewcode-block" id="ControlChannelUnblock.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlChannelUnblock.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dpid</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - dpid: unique integer identifier of the switch.</span>
<span class="sd">     - controller_id: unique string label for the controller.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ControlChannelUnblock</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dpid</span> <span class="o">=</span> <span class="n">dpid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span> <span class="o">=</span> <span class="n">controller_id</span>
</div>
<div class="viewcode-block" id="ControlChannelUnblock.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlChannelUnblock.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">switch</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">get_switch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dpid</span><span class="p">)</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">switch</span><span class="o">.</span><span class="n">get_connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span><span class="o">.</span><span class="n">io_worker</span><span class="o">.</span><span class="n">currently_blocked</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Expected channel </span><span class="si">%s</span><span class="s"> to be blocked&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">connection</span><span class="p">))</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">io_worker</span><span class="o">.</span><span class="n">unblock</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ControlChannelUnblock.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlChannelUnblock.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Fingerprint tuple format: (class name, dpid, controller id) &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dpid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">)</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ControlChannelUnblock.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlChannelUnblock.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;dpid&#39;</span><span class="p">,</span> <span class="s">&#39;controller_id&#39;</span><span class="p">)</span>
    <span class="n">dpid</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;dpid&#39;</span><span class="p">]</span>
    <span class="n">controller_id</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;controller_id&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ControlChannelUnblock</span><span class="p">(</span><span class="n">dpid</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="DataplaneDrop"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DataplaneDrop">[docs]</a><span class="k">class</span> <span class="nc">DataplaneDrop</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Removes an in-flight dataplane packet with the given fingerprint from</span>
<span class="sd">  the network. &#39;&#39;&#39;</span>
<div class="viewcode-block" id="DataplaneDrop.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DataplaneDrop.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">passive</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">     - passive: whether we&#39;re using Replayer.DataplaneChecker</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">DataplaneDrop</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="c"># N.B. fingerprint is monkeypatched on to DpPacketOut events by BufferedPatchPanel</span>
    <span class="k">if</span> <span class="n">fingerprint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">:</span>
      <span class="n">fingerprint</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span>
      <span class="n">fingerprint</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
      <span class="n">fingerprint</span> <span class="o">=</span> <span class="p">(</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">DPFingerprint</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                     <span class="n">fingerprint</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">fingerprint</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="n">fingerprint</span>
    <span class="c"># TODO(cs): passive is a bit of a hack, but this was easier.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">passive</span> <span class="o">=</span> <span class="n">passive</span>
</div>
<div class="viewcode-block" id="DataplaneDrop.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DataplaneDrop.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="c"># Handled by control_flow.replayer.DataplaneChecker</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">passive</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
     <span class="n">dp_event</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">patch_panel</span><span class="o">.</span><span class="n">get_buffered_dp_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
     <span class="k">if</span> <span class="n">dp_event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
       <span class="n">simulation</span><span class="o">.</span><span class="n">patch_panel</span><span class="o">.</span><span class="n">drop_dp_event</span><span class="p">(</span><span class="n">dp_event</span><span class="p">)</span>
       <span class="k">return</span> <span class="bp">True</span>
     <span class="k">return</span> <span class="bp">False</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="DataplaneDrop.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DataplaneDrop.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Fingerprint tuple format:</span>
<span class="sd">    (class name, DPFingerprint, switch dpid, port no)</span>
<span class="sd">    See fingerprints/messages.py for format of DPFingerprint.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="DataplaneDrop.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DataplaneDrop.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;fingerprint&#39;</span><span class="p">)</span>
    <span class="n">fingerprint</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;fingerprint&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">DataplaneDrop</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataplaneDrop.to_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DataplaneDrop.to_json">[docs]</a>  <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
    <span class="n">fields</span><span class="p">[</span><span class="s">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
    <span class="n">fields</span><span class="p">[</span><span class="s">&#39;fingerprint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">del</span> <span class="n">fields</span><span class="p">[</span><span class="s">&#39;_fingerprint&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

<span class="c"># TODO(cs): Temporary hack until we figure out determinism</span></div></div>
<div class="viewcode-block" id="LinkDiscovery"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkDiscovery">[docs]</a><span class="k">class</span> <span class="nc">LinkDiscovery</span><span class="p">(</span><span class="n">InputEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Deprecated &#39;&#39;&#39;</span>
<div class="viewcode-block" id="LinkDiscovery.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkDiscovery.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">,</span> <span class="n">link_attrs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">LinkDiscovery</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                        <span class="n">controller_id</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">link_attrs</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span> <span class="o">=</span> <span class="n">controller_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">link_attrs</span> <span class="o">=</span> <span class="n">link_attrs</span>
</div>
<div class="viewcode-block" id="LinkDiscovery.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkDiscovery.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">controller</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">controller_manager</span><span class="o">.</span><span class="n">get_controller</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">)</span>
    <span class="n">controller</span><span class="o">.</span><span class="n">sync_connection</span><span class="o">.</span><span class="n">send_link_notification</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">link_attrs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="LinkDiscovery.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkDiscovery.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="LinkDiscovery.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.LinkDiscovery.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;controller_id&#39;</span><span class="p">,</span> <span class="s">&#39;link_attrs&#39;</span><span class="p">)</span>
    <span class="n">controller_id</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;controller_id&#39;</span><span class="p">]</span>
    <span class="n">link_attrs</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;link_attrs&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">LinkDiscovery</span><span class="p">(</span><span class="n">controller_id</span><span class="p">,</span> <span class="n">link_attrs</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div></div>
<span class="n">all_input_events</span> <span class="o">=</span> <span class="p">[</span><span class="n">SwitchFailure</span><span class="p">,</span> <span class="n">SwitchRecovery</span><span class="p">,</span> <span class="n">LinkFailure</span><span class="p">,</span> <span class="n">LinkRecovery</span><span class="p">,</span>
                    <span class="n">ControllerFailure</span><span class="p">,</span> <span class="n">ControllerRecovery</span><span class="p">,</span> <span class="n">HostMigration</span><span class="p">,</span>
                    <span class="n">PolicyChange</span><span class="p">,</span> <span class="n">TrafficInjection</span><span class="p">,</span> <span class="n">WaitTime</span><span class="p">,</span> <span class="n">CheckInvariants</span><span class="p">,</span>
                    <span class="n">ControlChannelBlock</span><span class="p">,</span> <span class="n">ControlChannelUnblock</span><span class="p">,</span>
                    <span class="n">DataplaneDrop</span><span class="p">,</span> <span class="n">LinkDiscovery</span><span class="p">]</span>

<span class="c"># ----------------------------------- #</span>
<span class="c">#  Concrete classes of InternalEvents #</span>
<span class="c"># ----------------------------------- #</span>

<div class="viewcode-block" id="extract_base_fields"><a class="viewcode-back" href="../../sts.html#sts.replay_event.extract_base_fields">[docs]</a><span class="k">def</span> <span class="nf">extract_base_fields</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
  <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
  <span class="n">timeout_disallowed</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="k">if</span> <span class="s">&#39;timeout_disallowed&#39;</span> <span class="ow">in</span> <span class="n">json_hash</span><span class="p">:</span>
    <span class="n">timeout_disallowed</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;timeout_disallowed&#39;</span><span class="p">]</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ControlMessageBase"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlMessageBase">[docs]</a><span class="k">class</span> <span class="nc">ControlMessageBase</span><span class="p">(</span><span class="n">InternalEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Logged whenever the GodScheduler decides to allow a switch to receive or</span>
<span class="sd">  send an openflow packet.</span>
<span class="sd">  &#39;&#39;&#39;</span>
<div class="viewcode-block" id="ControlMessageBase.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlMessageBase.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dpid</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - dpid: unique integer identifier of the switch.</span>
<span class="sd">     - controller_id: unique string label for the controller.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">     - timeout_disallowed: whether the replayer should wait indefinitely for</span>
<span class="sd">       this event to occur. Defaults to False.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># If constructed directly (not from json), fingerprint is the</span>
    <span class="c"># OFFingerprint, not including dpid and controller_id</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ControlMessageBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="o">=</span><span class="n">timeout_disallowed</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dpid</span> <span class="o">=</span> <span class="n">dpid</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span> <span class="o">=</span> <span class="n">controller_id</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
      <span class="n">fingerprint</span> <span class="o">=</span> <span class="p">(</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">OFFingerprint</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                     <span class="n">fingerprint</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">tuple</span><span class="p">:</span>
      <span class="n">fingerprint</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">OFFingerprint</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">),</span>
                     <span class="n">dpid</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="n">fingerprint</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ControlMessageBase.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlMessageBase.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Fingerprint tuple format:</span>
<span class="sd">    (class name, OFFingerprint, dpid, controller id)</span>
<span class="sd">    See fingerprints/messages.py for OFFingerprint format.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span>
</div></div>
<div class="viewcode-block" id="ControlMessageReceive"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlMessageReceive">[docs]</a><span class="k">class</span> <span class="nc">ControlMessageReceive</span><span class="p">(</span><span class="n">ControlMessageBase</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Logged whenever the GodScheduler decides to allow a switch to receive an</span>
<span class="sd">  openflow message.</span>
<span class="sd">  &#39;&#39;&#39;</span>
<div class="viewcode-block" id="ControlMessageReceive.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlMessageReceive.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">message_waiting</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">god_scheduler</span><span class="o">.</span><span class="n">message_receipt_waiting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_receive</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">message_waiting</span><span class="p">:</span>
      <span class="n">simulation</span><span class="o">.</span><span class="n">god_scheduler</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_receive</span><span class="p">)</span>
      <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ControlMessageReceive.pending_receive"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlMessageReceive.pending_receive">[docs]</a>  <span class="k">def</span> <span class="nf">pending_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">PendingReceive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dpid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</div>
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;ControlMessageReceive:</span><span class="si">%s</span><span class="s"> c </span><span class="si">%s</span><span class="s"> -&gt; s </span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">human_str</span><span class="p">())</span>

  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ControlMessageReceive.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlMessageReceive.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_base_fields</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;dpid&#39;</span><span class="p">,</span> <span class="s">&#39;controller_id&#39;</span><span class="p">,</span> <span class="s">&#39;fingerprint&#39;</span><span class="p">)</span>
    <span class="n">dpid</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;dpid&#39;</span><span class="p">]</span>
    <span class="n">controller_id</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;controller_id&#39;</span><span class="p">]</span>
    <span class="n">fingerprint</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;fingerprint&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ControlMessageReceive</span><span class="p">(</span><span class="n">dpid</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">,</span>
            <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="o">=</span><span class="n">timeout_disallowed</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="ControlMessageSend"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlMessageSend">[docs]</a><span class="k">class</span> <span class="nc">ControlMessageSend</span><span class="p">(</span><span class="n">ControlMessageBase</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Logged whenever the GodScheduler decides to allow a switch to send an</span>
<span class="sd">  openflow message.</span>
<span class="sd">  &#39;&#39;&#39;</span>
<div class="viewcode-block" id="ControlMessageSend.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlMessageSend.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">message_waiting</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">god_scheduler</span><span class="o">.</span><span class="n">message_send_waiting</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_send</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">message_waiting</span><span class="p">:</span>
      <span class="n">simulation</span><span class="o">.</span><span class="n">god_scheduler</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_send</span><span class="p">)</span>
      <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ControlMessageSend.pending_send"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlMessageSend.pending_send">[docs]</a>  <span class="k">def</span> <span class="nf">pending_send</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">PendingSend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dpid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</div>
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;ControlMessageSend:</span><span class="si">%s</span><span class="s"> c </span><span class="si">%s</span><span class="s"> -&gt; s </span><span class="si">%s</span><span class="s"> [</span><span class="si">%s</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dpid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">human_str</span><span class="p">())</span>

  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ControlMessageSend.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControlMessageSend.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_base_fields</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;dpid&#39;</span><span class="p">,</span> <span class="s">&#39;controller_id&#39;</span><span class="p">,</span> <span class="s">&#39;fingerprint&#39;</span><span class="p">)</span>
    <span class="n">dpid</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;dpid&#39;</span><span class="p">]</span>
    <span class="n">controller_id</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;controller_id&#39;</span><span class="p">]</span>
    <span class="n">fingerprint</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;fingerprint&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ControlMessageSend</span><span class="p">(</span><span class="n">dpid</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="o">=</span><span class="n">timeout_disallowed</span><span class="p">)</span>

<span class="c"># TODO(cs): move me?</span></div></div>
<div class="viewcode-block" id="PendingStateChange"><a class="viewcode-back" href="../../sts.html#sts.replay_event.PendingStateChange">[docs]</a><span class="k">class</span> <span class="nc">PendingStateChange</span><span class="p">(</span><span class="n">namedtuple</span><span class="p">(</span><span class="s">&#39;PendingStateChange&#39;</span><span class="p">,</span>
                                <span class="p">[</span><span class="s">&#39;controller_id&#39;</span><span class="p">,</span> <span class="s">&#39;time&#39;</span><span class="p">,</span> <span class="s">&#39;fingerprint&#39;</span><span class="p">,</span>
                                 <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">])):</span>
  <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">controller_id</span> <span class="o">=</span> <span class="n">controller_id</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
      <span class="n">time</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
      <span class="n">fingerprint</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
      <span class="n">value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">PendingStateChange</span><span class="p">)</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span>
                                                  <span class="n">fingerprint</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">_get_regex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># TODO(cs): if we add varargs to the signature, this needs to be changed</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">)</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
      <span class="c"># Skip over the class name</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span>

  <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># TODO(cs): may need to add more context into the fingerprint to avoid</span>
    <span class="c"># ambiguity</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_regex</span><span class="p">()</span><span class="o">.</span><span class="n">__hash__</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="o">.</span><span class="n">__hash__</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_regex</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_get_regex</span><span class="p">()</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">controller_id</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="c"># NOTE: __ne__ in python does *NOT* by default delegate to eq</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ControllerStateChange"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerStateChange">[docs]</a><span class="k">class</span> <span class="nc">ControllerStateChange</span><span class="p">(</span><span class="n">InternalEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Logged for any (visible) state change in the controller (e.g.</span>
<span class="sd">  mastership change). Visibility into controller state changes is obtained</span>
<span class="sd">  via syncproto.</span>
<span class="sd">  &#39;&#39;&#39;</span>
<div class="viewcode-block" id="ControllerStateChange.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerStateChange.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - controller_id: unique string label for the controller.</span>
<span class="sd">     - name: The format string passed to the controller&#39;s logging library.</span>
<span class="sd">     - value: An array of values for the format string.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">     - timeout_disallowed: whether the replayer should wait indefinitely for</span>
<span class="sd">       this event to occur. Defaults to False.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">ControllerStateChange</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="o">=</span><span class="n">timeout_disallowed</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span> <span class="o">=</span> <span class="n">controller_id</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span> <span class="o">==</span> <span class="nb">unicode</span><span class="p">:</span>
      <span class="n">fingerprint</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
      <span class="n">fingerprint</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="n">fingerprint</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
      <span class="n">value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="ControllerStateChange.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerStateChange.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">observed_yet</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">controller_sync_callback</span>\
                             <span class="o">.</span><span class="n">state_change_pending</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_state_change</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">observed_yet</span><span class="p">:</span>
      <span class="n">simulation</span><span class="o">.</span><span class="n">controller_sync_callback</span>\
                <span class="o">.</span><span class="n">ack_pending_state_change</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pending_state_change</span><span class="p">)</span>
      <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="ControllerStateChange.pending_state_change"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerStateChange.pending_state_change">[docs]</a>  <span class="k">def</span> <span class="nf">pending_state_change</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">PendingStateChange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">_get_message_fingerprint</span><span class="p">(),</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</div>
  <span class="k">def</span> <span class="nf">_get_message_fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

  <span class="nd">@property</span>
<div class="viewcode-block" id="ControllerStateChange.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerStateChange.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Fingerprint tuple format:</span>
<span class="sd">    (class name, PendingStateChange.fingerprint, controller id)</span>
<span class="sd">    PendingStateChange.fingerprint is the format string passed to the</span>
<span class="sd">    controller&#39;s logging library (without interpolated values)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># Somewhat confusing: the StateChange&#39;s fingerprint is self._fingerprint,</span>
    <span class="c"># but the overall fingerprint of this event needs to include the controller</span>
    <span class="c"># id</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">])</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ControllerStateChange.from_pending_state_change"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerStateChange.from_pending_state_change">[docs]</a>  <span class="k">def</span> <span class="nf">from_pending_state_change</span><span class="p">(</span><span class="n">state_change</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ControllerStateChange</span><span class="p">(</span><span class="n">state_change</span><span class="o">.</span><span class="n">controller_id</span><span class="p">,</span>
            <span class="n">state_change</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">,</span> <span class="n">state_change</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">state_change</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">state_change</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ControllerStateChange.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ControllerStateChange.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_base_fields</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;controller_id&#39;</span><span class="p">,</span> <span class="s">&#39;_fingerprint&#39;</span><span class="p">,</span>
                        <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">)</span>
    <span class="n">controller_id</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;controller_id&#39;</span><span class="p">]</span>
    <span class="n">fingerprint</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;_fingerprint&#39;</span><span class="p">]</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ControllerStateChange</span><span class="p">(</span><span class="n">controller_id</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                                 <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                                 <span class="n">timeout_disallowed</span><span class="o">=</span><span class="n">timeout_disallowed</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="DeterministicValue"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DeterministicValue">[docs]</a><span class="k">class</span> <span class="nc">DeterministicValue</span><span class="p">(</span><span class="n">InternalEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Logged whenever the controller asks for a deterministic value (e.g.</span>
<span class="sd">  gettimeofday()</span>
<span class="sd">  &#39;&#39;&#39;</span>
<div class="viewcode-block" id="DeterministicValue.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DeterministicValue.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">controller_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - controller_id: unique string label for the controller.</span>
<span class="sd">     - name: name of the DeterministicValue request, e.g. &quot;gettimeofday&quot;</span>
<span class="sd">     - value: the return value of the DeterministicValue request.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">     - timeout_disallowed: whether the replayer should wait indefinitely for</span>
<span class="sd">       this event to occur. Defaults to False.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">DeterministicValue</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="o">=</span><span class="n">timeout_disallowed</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span> <span class="o">=</span> <span class="n">controller_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&quot;gettimeofday&quot;</span><span class="p">:</span>
      <span class="n">value</span> <span class="o">=</span> <span class="n">SyncTime</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">microSeconds</span><span class="o">=</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
      <span class="n">value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="DeterministicValue.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DeterministicValue.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">simulation</span><span class="o">.</span><span class="n">controller_sync_callback</span>\
                 <span class="o">.</span><span class="n">pending_deterministic_value_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">):</span>
      <span class="n">simulation</span><span class="o">.</span><span class="n">controller_sync_callback</span><span class="o">.</span><span class="n">send_deterministic_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controller_id</span><span class="p">,</span>
                                                                   <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
      <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="DeterministicValue.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DeterministicValue.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_base_fields</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;controller_id&#39;</span><span class="p">,</span>
                        <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">)</span>
    <span class="n">controller_id</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;controller_id&#39;</span><span class="p">]</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">DeterministicValue</span><span class="p">(</span><span class="n">controller_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span>
                              <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="o">=</span><span class="n">timeout_disallowed</span><span class="p">)</span>

<span class="c"># TODO(cs): this should really be an input event. But need to make sure that</span>
<span class="c"># it can be pruned safely</span></div></div>
<div class="viewcode-block" id="ConnectToControllers"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ConnectToControllers">[docs]</a><span class="k">class</span> <span class="nc">ConnectToControllers</span><span class="p">(</span><span class="n">InternalEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Logged at the beginning of the execution. Causes all switches to open</span>
<span class="sd">  TCP connections their their parent controller(s).</span>
<span class="sd">  &#39;&#39;&#39;</span>
<div class="viewcode-block" id="ConnectToControllers.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ConnectToControllers.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="n">simulation</span><span class="o">.</span><span class="n">connect_to_controllers</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">True</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ConnectToControllers.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.ConnectToControllers.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">,</span> <span class="n">timeout_disallowed</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_base_fields</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ConnectToControllers</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span>
                                <span class="n">timeout_disallowed</span><span class="o">=</span><span class="n">timeout_disallowed</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="DataplanePermit"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DataplanePermit">[docs]</a><span class="k">class</span> <span class="nc">DataplanePermit</span><span class="p">(</span><span class="n">InternalEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; DataplanePermit allows a packet to move from one port to another in the</span>
<span class="sd">  dataplane. We basically just keep this around for bookkeeping purposes. During</span>
<span class="sd">  replay, this let&#39;s us know which packets to let through, and which to drop.</span>
<span class="sd">  &#39;&#39;&#39;</span>
<div class="viewcode-block" id="DataplanePermit.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DataplanePermit.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">passive</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">     - passive: whether we&#39;re using Replayer.DataplaneChecker</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c"># N.B. fingerprint is monkeypatched onto DpPacketOut events by</span>
    <span class="c"># BufferedPatchPanel</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">DataplanePermit</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">fingerprint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">:</span>
      <span class="n">fingerprint</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span>
      <span class="n">fingerprint</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
      <span class="n">fingerprint</span> <span class="o">=</span> <span class="p">(</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">DPFingerprint</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                     <span class="n">fingerprint</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">fingerprint</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span> <span class="o">=</span> <span class="n">fingerprint</span>
    <span class="c"># TODO(cs): passive is a bit of a hack, but this was easier.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">passive</span> <span class="o">=</span> <span class="n">passive</span>
</div>
<div class="viewcode-block" id="DataplanePermit.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DataplanePermit.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simulation</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">passive</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">dp_event</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">patch_panel</span><span class="o">.</span><span class="n">get_buffered_dp_event</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
      <span class="k">if</span> <span class="n">dp_event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">patch_panel</span><span class="o">.</span><span class="n">permit_dp_event</span><span class="p">(</span><span class="n">dp_event</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
      <span class="k">return</span> <span class="bp">False</span>
</div>
  <span class="nd">@property</span>
<div class="viewcode-block" id="DataplanePermit.fingerprint"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DataplanePermit.fingerprint">[docs]</a>  <span class="k">def</span> <span class="nf">fingerprint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Fingerprint tuple format:</span>
<span class="sd">    (class name, DPFingerprint, switch dpid, port no)</span>
<span class="sd">    See fingerprints/messages.py for format of DPFingerprint.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fingerprint</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="DataplanePermit.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DataplanePermit.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;fingerprint&#39;</span><span class="p">)</span>
    <span class="n">fingerprint</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;fingerprint&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">DataplanePermit</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DataplanePermit.to_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.DataplanePermit.to_json">[docs]</a>  <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>
    <span class="n">fields</span><span class="p">[</span><span class="s">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
    <span class="n">fields</span><span class="p">[</span><span class="s">&#39;fingerprint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">fingerprint</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">del</span> <span class="n">fields</span><span class="p">[</span><span class="s">&#39;_fingerprint&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
</div></div>
<span class="n">all_internal_events</span> <span class="o">=</span> <span class="p">[</span><span class="n">ControlMessageReceive</span><span class="p">,</span> <span class="n">ControlMessageSend</span><span class="p">,</span>
                       <span class="n">ConnectToControllers</span><span class="p">,</span> <span class="n">ControllerStateChange</span><span class="p">,</span>
                       <span class="n">DeterministicValue</span><span class="p">,</span> <span class="n">DataplanePermit</span><span class="p">]</span>

<span class="c"># Special events:</span>

<div class="viewcode-block" id="SpecialEvent"><a class="viewcode-back" href="../../sts.html#sts.replay_event.SpecialEvent">[docs]</a><span class="k">class</span> <span class="nc">SpecialEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
<div class="viewcode-block" id="SpecialEvent.proceed"><a class="viewcode-back" href="../../sts.html#sts.replay_event.SpecialEvent.proceed">[docs]</a>  <span class="k">def</span> <span class="nf">proceed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Should never be called!&quot;</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="InvariantViolation"><a class="viewcode-back" href="../../sts.html#sts.replay_event.InvariantViolation">[docs]</a><span class="k">class</span> <span class="nc">InvariantViolation</span><span class="p">(</span><span class="n">SpecialEvent</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; Class for logging violations as json dicts &#39;&#39;&#39;</span>
<div class="viewcode-block" id="InvariantViolation.__init__"><a class="viewcode-back" href="../../sts.html#sts.replay_event.InvariantViolation.__init__">[docs]</a>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">violations</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parameters:</span>
<span class="sd">     - violations: an array of strings specifying the invariant violation</span>
<span class="sd">       fingerprints. Format of the strings depends on the invariant check.</span>
<span class="sd">       Empty array means there were no violations.</span>
<span class="sd">     - label: a unique label for this event. Internal event labels begin with &#39;i&#39;</span>
<span class="sd">       and input event labels begin with &#39;e&#39;.</span>
<span class="sd">     - time: the timestamp of when this event occured. Stored as a tuple:</span>
<span class="sd">       [seconds since unix epoch, microseconds].</span>
<span class="sd">     - round: optional integer. Indicates what simulation round this event occured</span>
<span class="sd">       in.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">Event</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">violations</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">violations</span> <span class="p">]</span>
</div>
  <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="InvariantViolation.from_json"><a class="viewcode-back" href="../../sts.html#sts.replay_event.InvariantViolation.from_json">[docs]</a>  <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">json_hash</span><span class="p">):</span>
    <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span> <span class="o">=</span> <span class="n">extract_label_time</span><span class="p">(</span><span class="n">json_hash</span><span class="p">)</span>
    <span class="n">assert_fields_exist</span><span class="p">(</span><span class="n">json_hash</span><span class="p">,</span> <span class="s">&#39;violations&#39;</span><span class="p">)</span>
    <span class="n">violations</span> <span class="o">=</span> <span class="n">json_hash</span><span class="p">[</span><span class="s">&#39;violations&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">InvariantViolation</span><span class="p">(</span><span class="n">violations</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="nb">round</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
</div></div>
<span class="n">all_special_events</span> <span class="o">=</span> <span class="p">[</span><span class="n">InvariantViolation</span><span class="p">]</span>

<span class="n">all_events</span> <span class="o">=</span> <span class="n">all_input_events</span> <span class="o">+</span> <span class="n">all_internal_events</span> <span class="o">+</span> <span class="n">all_special_events</span>

<span class="n">dp_events</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">DataplanePermit</span><span class="p">,</span> <span class="n">DataplaneDrop</span><span class="p">])</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">STS 0.1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Colin Scott.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>